{"title":"Java字节码初步学习","uid":"d401c16d5adfa98368631db68a02ca33","slug":"Java字节码初步学习","date":"2024-06-10T05:00:00.000Z","updated":"2024-06-28T15:09:11.735Z","comments":true,"path":"api/articles/Java字节码初步学习.json","keywords":null,"cover":"https://bu.dusays.com/2024/03/11/65ee760bd1078.jpg","content":"<h1 id=\"背景引入\"><a href=\"#背景引入\" class=\"headerlink\" title=\"背景引入\"></a>背景引入</h1><p>我们平常所写的 Java 是不能被 JVM 识别所运行的，必须将其编译成 class 文件，JVM 才能够识别代码，进行对应的程序操作。<br>Java 有着”一次编译，到处运行”的特点，也就是说当我们对一份 java 代码进行编译之后，得到的 class 文件能够放在任意机器或者任意 OS 系统中的 JVM 中识别并运行。当然 JVM 并不止单单支持 Java。</p>\n<h1 id=\"Java-字节码文件\"><a href=\"#Java-字节码文件\" class=\"headerlink\" title=\"Java 字节码文件\"></a>Java 字节码文件</h1><p>class 文件本质是一个以 8 位字节为基础的二进制流。所有的 class 文件开头的前四个字节都是固定的魔数– 0xCAFEBABE  （咖啡宝贝）。当然这个主要是用来让 JVM 识别该文件是否为 class 文件<br>该 class 文件编译之前采用的 Java 版本在魔数之后的 4 个字节给出，前两个字节表示次版本号，后两个字节表示主版本号。class 文件的 10 进制形式能够在 oracle 官网进行版本查询，得知更加具体的版本号<br>比如我此时编译一份 java 文件</p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C678DD\">package</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">org.example</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">public</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">class</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">person</span><span style=\"color: #E06C75\"> </span><span style=\"color: #ABB2BF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #C678DD\">private</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">int</span><span style=\"color: #E06C75\"> num </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #C678DD\">public</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">static</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">int</span><span style=\"color: #E06C75\"> NUM </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> </span><span style=\"color: #D19A66\">100</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #C678DD\">public</span><span style=\"color: #61AFEF\"> </span><span style=\"color: #C678DD\">int</span><span style=\"color: #61AFEF\"> func</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75; font-style: italic\">a</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75; font-style: italic\">b</span><span style=\"color: #ABB2BF\">)</span><span style=\"color: #61AFEF\"> </span><span style=\"color: #ABB2BF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">add</span><span style=\"color: #ABB2BF\">(a, b);</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    &#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #C678DD\">public</span><span style=\"color: #61AFEF\"> </span><span style=\"color: #C678DD\">int</span><span style=\"color: #61AFEF\"> add</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75; font-style: italic\">a</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75; font-style: italic\">b</span><span style=\"color: #ABB2BF\">)</span><span style=\"color: #61AFEF\"> </span><span style=\"color: #ABB2BF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> a </span><span style=\"color: #56B6C2\">+</span><span style=\"color: #ABB2BF\"> b </span><span style=\"color: #56B6C2\">+</span><span style=\"color: #ABB2BF\"> num;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    &#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #C678DD\">public</span><span style=\"color: #61AFEF\"> </span><span style=\"color: #C678DD\">int</span><span style=\"color: #61AFEF\"> sub</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75; font-style: italic\">a</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75; font-style: italic\">b</span><span style=\"color: #ABB2BF\">)</span><span style=\"color: #61AFEF\"> </span><span style=\"color: #ABB2BF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> a </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #ABB2BF\"> b </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #ABB2BF\"> NUM;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">&#125;</span></span></code></pre></div><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/36078896/1717636679191-592e658b-375d-44f1-b31c-c6e262a8d8e5.png#averageHue=%2339352f&clientId=u2db5ed67-1d88-4&from=paste&height=412&id=u16fc67c3&originHeight=772&originWidth=891&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=103764&status=done&style=none&taskId=ue9b5197e-87d1-44da-9d2b-7a32012e4f1&title=&width=475.2\" referrerpolicy=\"no-referrer\" alt=\"image.png\"><br>这还只是 class 文件的二进制形式，我们能够通过其他工具查看到更加具体的 class 字节码内容。<br>比如 idea 的自带的 view 功能。这里我们依然选择 person 类编译之后的 class 文件进行查看<br>选定 person.class 文件之后点击上方的 view，然后选择 Show ByteCode<br><img src=\"https://cdn.nlark.com/yuque/0/2024/png/36078896/1717637395234-7db3aa5f-6732-4237-b928-bb284ea54bbf.png#averageHue=%232b2d31&clientId=u2db5ed67-1d88-4&from=paste&height=725&id=ue126df8f&originHeight=1360&originWidth=2560&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=500817&status=done&style=none&taskId=ua6b81c73-8d1e-4bf8-92b9-3633c426f7d&title=&width=1365.3333333333333\" referrerpolicy=\"no-referrer\" alt=\"image.png\"><br>就可以得到这么一份还算比较好看的 Bytecode<br><img src=\"https://cdn.nlark.com/yuque/0/2024/png/36078896/1717637421316-50c01060-83ac-484b-beb3-5bcd227dc70f.png#averageHue=%23262829&clientId=u2db5ed67-1d88-4&from=paste&height=730&id=u9197cf49&originHeight=1368&originWidth=1417&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=85328&status=done&style=none&taskId=ufe4b5178-5ce0-4385-94d7-88ac8dd09a4&title=&width=755.7333333333333\" referrerpolicy=\"no-referrer\" alt=\"image.png\"><br>或者我们采用<code>javap</code>java 原生的字节码工具也能够查看。<br>来一份 javap 的参数表</p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #E06C75\">help  </span><span style=\"color: #ABB2BF\">--</span><span style=\"color: #E06C75\">help  </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #C678DD\">?</span><span style=\"color: #E06C75\">        输出此用法消息</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #E06C75\">version                 版本信息</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #E06C75\">v  </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #E06C75\">verbose             输出附加信息</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #E06C75\">l                       输出行号和本地变量表</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #C678DD\">public</span><span style=\"color: #E06C75\">                  仅显示公共类和成员</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #C678DD\">protected</span><span style=\"color: #E06C75\">               显示受保护的</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E06C75\">公共类和成员</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #56B6C2\">-</span><span style=\"color: #C678DD\">package</span><span style=\"color: #E06C75\">                 </span><span style=\"color: #C678DD\">显示程序包/受保护的/公共类</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">                           和成员 (默认)</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">  </span><span style=\"color: #FFFFFF\">-</span><span style=\"color: #C678DD\">p  </span><span style=\"color: #FFFFFF\">-private</span><span style=\"color: #C678DD\">             显示所有类和成员</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">  </span><span style=\"color: #FFFFFF\">-</span><span style=\"color: #C678DD\">c                       对代码进行反汇编</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">  </span><span style=\"color: #FFFFFF\">-</span><span style=\"color: #C678DD\">s                       输出内部类型签名</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">  </span><span style=\"color: #FFFFFF\">-</span><span style=\"color: #C678DD\">sysinfo                 显示正在处理的类的</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">                           系统信息 (路径, 大小, 日期, </span><span style=\"color: #FFFFFF\">MD</span><span style=\"color: #C678DD\">5 散列)</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">  </span><span style=\"color: #FFFFFF\">-</span><span style=\"color: #C678DD\">constants               显示最终常量</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">  </span><span style=\"color: #FFFFFF\">-</span><span style=\"color: #C678DD\">classpath &lt;path&gt;        指定查找用户类文件的位置</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">  </span><span style=\"color: #FFFFFF\">-</span><span style=\"color: #C678DD\">cp &lt;path&gt;               指定查找用户类文件的位置</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">  </span><span style=\"color: #FFFFFF\">-</span><span style=\"color: #C678DD\">bootclasspath &lt;path&gt;    覆盖引导类文件的位置</span></span></code></pre></div><p>这里用 <code>javap -verbose -p person.class</code> 生成的字节码查看如下</p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C678DD\">public</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">class</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">org</span><span style=\"color: #E06C75\">.example.person</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  minor version: 0</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  major version: 52</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  flags: ACC_PUBLIC, ACC_SUPER</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">Constant pool:</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #1 = Methodref          #6.#26         </span><span style=\"color: #7F848E; font-style: italic\">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #2 = Fieldref           #5.#27         </span><span style=\"color: #7F848E; font-style: italic\">// org/example/person.num:I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #3 = Methodref          #5.#28         </span><span style=\"color: #7F848E; font-style: italic\">// org/example/person.add:(II)I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #4 = Fieldref           #5.#29         </span><span style=\"color: #7F848E; font-style: italic\">// org/example/person.NUM:I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #5 = Class              #30            </span><span style=\"color: #7F848E; font-style: italic\">// org/example/person</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #6 = Class              #31            </span><span style=\"color: #7F848E; font-style: italic\">// java/lang/Object</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #7 = Utf8               num</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #8 = Utf8               I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #9 = Utf8               NUM</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #10 = Utf8               </span><span style=\"color: #ABB2BF\">&lt;</span><span style=\"color: #E5C07B\">init</span><span style=\"color: #ABB2BF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #11 = Utf8               ()V</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #12 = Utf8               Code</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #13 = Utf8               LineNumberTable</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #14 = Utf8               LocalVariableTable</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #15 = Utf8               this</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #16 = Utf8               Lorg/example/person;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #17 = Utf8               func</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #18 = Utf8               (II)I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #19 = Utf8               a</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #20 = Utf8               b</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #21 = Utf8               add</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #22 = Utf8               sub</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #23 = Utf8               </span><span style=\"color: #ABB2BF\">&lt;</span><span style=\"color: #E5C07B\">clinit</span><span style=\"color: #ABB2BF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #24 = Utf8               SourceFile</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #25 = Utf8               person.java</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #26 = NameAndType        #10:#11        </span><span style=\"color: #7F848E; font-style: italic\">// &quot;&lt;init&gt;&quot;:()V</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #27 = NameAndType        #7:#8          </span><span style=\"color: #7F848E; font-style: italic\">// num:I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #28 = NameAndType        #21:#18        </span><span style=\"color: #7F848E; font-style: italic\">// add:(II)I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #29 = NameAndType        #9:#8          </span><span style=\"color: #7F848E; font-style: italic\">// NUM:I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #30 = Utf8               org/example/person</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #31 = Utf8               java/lang/Object</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #C678DD\">private</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">int</span><span style=\"color: #E06C75\"> num</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    descriptor</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    flags</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">ACC_PRIVATE</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #C678DD\">public</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">static</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">int</span><span style=\"color: #E06C75\"> NUM</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    descriptor</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    flags</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> ACC_PUBLIC</span><span style=\"color: #ABB2BF\">,</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">ACC_STATIC</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #C678DD\">public</span><span style=\"color: #61AFEF\"> org.example.person</span><span style=\"color: #ABB2BF\">();</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #61AFEF\">descriptor: ()V</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">    flags: ACC_PUBLIC</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">    Code:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      stack=2, locals=1, args_size=1</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         0: aload_0</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         1: invokespecial #1                  </span><span style=\"color: #7F848E; font-style: italic\">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         4: aload_0</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         5: iconst_1</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         6: putfield      #2                  </span><span style=\"color: #7F848E; font-style: italic\">// Field num:I</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         9: return</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      LineNumberTable:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">        line 3: 0</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">        line 4: 4</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      LocalVariableTable:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">        Start  Length  Slot  Name   Signature</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">            0      10     0  this   Lorg/example/person</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #C678DD\">public</span><span style=\"color: #61AFEF\"> </span><span style=\"color: #C678DD\">int</span><span style=\"color: #61AFEF\"> func</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #61AFEF\">descriptor: (II)I</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">    flags: ACC_PUBLIC</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">    Code:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      stack=3, locals=3, args_size=3</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         0: aload_0</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         1: iload_1</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         2: iload_2</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         3: invokevirtual #3                  </span><span style=\"color: #7F848E; font-style: italic\">// Method add:(II)I</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         6: ireturn</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      LineNumberTable:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">        line 8: 0</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      LocalVariableTable:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">        Start  Length  Slot  Name   Signature</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">            0       7     0  this   Lorg/example/person</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">            </span><span style=\"color: #D19A66\">0</span><span style=\"color: #E06C75\">       </span><span style=\"color: #D19A66\">7</span><span style=\"color: #E06C75\">     </span><span style=\"color: #D19A66\">1</span><span style=\"color: #E06C75\">     a   </span><span style=\"color: #E5C07B\">I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">            </span><span style=\"color: #D19A66\">0</span><span style=\"color: #E06C75\">       </span><span style=\"color: #D19A66\">7</span><span style=\"color: #E06C75\">     </span><span style=\"color: #D19A66\">2</span><span style=\"color: #E06C75\">     b   </span><span style=\"color: #E5C07B\">I</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #C678DD\">public</span><span style=\"color: #61AFEF\"> </span><span style=\"color: #C678DD\">int</span><span style=\"color: #61AFEF\"> add</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #61AFEF\">descriptor: (II)I</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">    flags: ACC_PUBLIC</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">    Code:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      stack=2, locals=3, args_size=3</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         0: iload_1</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         1: iload_2</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         2: iadd</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         3: aload_0</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         4: getfield      #2                  </span><span style=\"color: #7F848E; font-style: italic\">// Field num:I</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         7: iadd</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         8: ireturn</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      LineNumberTable:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">        line 12: 0</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      LocalVariableTable:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">        Start  Length  Slot  Name   Signature</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">            0       9     0  this   Lorg/example/person</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">            </span><span style=\"color: #D19A66\">0</span><span style=\"color: #E06C75\">       </span><span style=\"color: #D19A66\">9</span><span style=\"color: #E06C75\">     </span><span style=\"color: #D19A66\">1</span><span style=\"color: #E06C75\">     a   </span><span style=\"color: #E5C07B\">I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">            </span><span style=\"color: #D19A66\">0</span><span style=\"color: #E06C75\">       </span><span style=\"color: #D19A66\">9</span><span style=\"color: #E06C75\">     </span><span style=\"color: #D19A66\">2</span><span style=\"color: #E06C75\">     b   </span><span style=\"color: #E5C07B\">I</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #C678DD\">public</span><span style=\"color: #61AFEF\"> </span><span style=\"color: #C678DD\">int</span><span style=\"color: #61AFEF\"> sub</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #C678DD\">int</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #61AFEF\">descriptor: (II)I</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">    flags: ACC_PUBLIC</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">    Code:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      stack=2, locals=3, args_size=3</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         0: iload_1</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         1: iload_2</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         2: isub</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         3: getstatic     #4                  </span><span style=\"color: #7F848E; font-style: italic\">// Field NUM:I</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         6: isub</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         7: ireturn</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      LineNumberTable:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">        line 16: 0</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      LocalVariableTable:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">        Start  Length  Slot  Name   Signature</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">            0       8     0  this   Lorg/example/person</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">            </span><span style=\"color: #D19A66\">0</span><span style=\"color: #E06C75\">       </span><span style=\"color: #D19A66\">8</span><span style=\"color: #E06C75\">     </span><span style=\"color: #D19A66\">1</span><span style=\"color: #E06C75\">     a   </span><span style=\"color: #E5C07B\">I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">            </span><span style=\"color: #D19A66\">0</span><span style=\"color: #E06C75\">       </span><span style=\"color: #D19A66\">8</span><span style=\"color: #E06C75\">     </span><span style=\"color: #D19A66\">2</span><span style=\"color: #E06C75\">     b   </span><span style=\"color: #E5C07B\">I</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #C678DD\">static</span><span style=\"color: #E06C75\"> &#123;&#125;</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #61AFEF\">descriptor: ()V</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">    flags: ACC_STATIC</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">    Code:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      stack=1, locals=0, args_size=0</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         0: bipush        100</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         2: putstatic     #4                  </span><span style=\"color: #7F848E; font-style: italic\">// Field NUM:I</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">         5: return</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">      LineNumberTable:</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">        line 5: 0</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">&#125;</span></span></code></pre></div><p>发现结果还是不同的，javap 的生成感觉可读性更高。两者内容比较是没有问题的。<code>javap -verbose -p person.class</code>的内容直接把常量池中的所有信息都打印出来，我们也能够更好的查找。</p>\n<h2 id=\"常量池（Constant-pool）\"><a href=\"#常量池（Constant-pool）\" class=\"headerlink\" title=\"常量池（Constant pool）\"></a>常量池（Constant pool）</h2><p>最显著的就是我们最开始用<code>javap -verbose -p person.class</code>产生的结果中那一堆用#表示的信息。<br>常量池可以理解为 class 文件中的资源仓库，主要存放两大类常量：字面量(Literal),和符号引用(Symbolic References) 。字面量就类似于 java 中的常量概念，如文本字符串，final 常量等。而符号引用则属于编译原理方面的概念，包含以下三种：</p>\n<ul>\n<li>类接口的全限定名</li>\n<li>字段的名称和描述符号</li>\n<li>方法的名称和描述</li>\n</ul>\n<p>我们截取生成字节码中常量池的部分内容</p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #E5C07B\">Constant</span><span style=\"color: #E06C75\"> pool</span><span style=\"color: #C678DD\">:</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #</span><span style=\"color: #D19A66\">1</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> Methodref          #</span><span style=\"color: #D19A66\">6.</span><span style=\"color: #E06C75\">#</span><span style=\"color: #D19A66\">26</span><span style=\"color: #E06C75\">         </span><span style=\"color: #7F848E; font-style: italic\">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #</span><span style=\"color: #D19A66\">2</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> Fieldref           #</span><span style=\"color: #D19A66\">5.</span><span style=\"color: #E06C75\">#</span><span style=\"color: #D19A66\">27</span><span style=\"color: #E06C75\">         </span><span style=\"color: #7F848E; font-style: italic\">// org/example/person.num:I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #</span><span style=\"color: #D19A66\">3</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> Methodref          #</span><span style=\"color: #D19A66\">5.</span><span style=\"color: #E06C75\">#</span><span style=\"color: #D19A66\">28</span><span style=\"color: #E06C75\">         </span><span style=\"color: #7F848E; font-style: italic\">// org/example/person.add:(II)I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #</span><span style=\"color: #D19A66\">4</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> Fieldref           #</span><span style=\"color: #D19A66\">5.</span><span style=\"color: #E06C75\">#</span><span style=\"color: #D19A66\">29</span><span style=\"color: #E06C75\">         </span><span style=\"color: #7F848E; font-style: italic\">// org/example/person.NUM:I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #</span><span style=\"color: #D19A66\">5</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> Class              #</span><span style=\"color: #D19A66\">30</span><span style=\"color: #E06C75\">            </span><span style=\"color: #7F848E; font-style: italic\">// org/example/person</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #</span><span style=\"color: #D19A66\">6</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> Class              #</span><span style=\"color: #D19A66\">31</span><span style=\"color: #E06C75\">            </span><span style=\"color: #7F848E; font-style: italic\">// java/lang/Object</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #</span><span style=\"color: #D19A66\">7</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">Utf8</span><span style=\"color: #E06C75\">               num</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   #</span><span style=\"color: #D19A66\">8</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">Utf8</span><span style=\"color: #E06C75\">               </span><span style=\"color: #E5C07B\">I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #</span><span style=\"color: #D19A66\">10</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">Utf8</span><span style=\"color: #E06C75\">               </span><span style=\"color: #56B6C2\">&lt;</span><span style=\"color: #E06C75\">init</span><span style=\"color: #56B6C2\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #</span><span style=\"color: #D19A66\">11</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> </span><span style=\"color: #61AFEF\">Utf8</span><span style=\"color: #E06C75\">               ()</span><span style=\"color: #E5C07B\">V</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #</span><span style=\"color: #D19A66\">26</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> NameAndType        #</span><span style=\"color: #D19A66\">10</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\">#</span><span style=\"color: #D19A66\">11</span><span style=\"color: #E06C75\">        </span><span style=\"color: #7F848E; font-style: italic\">// &quot;&lt;init&gt;&quot;:()V</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #</span><span style=\"color: #D19A66\">27</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> NameAndType        #</span><span style=\"color: #D19A66\">7</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\">#</span><span style=\"color: #D19A66\">8</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">  #</span><span style=\"color: #D19A66\">31</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">Utf8</span><span style=\"color: #E06C75\">               java</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E06C75\">lang</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E5C07B\">Object</span></span></code></pre></div><p>举个例子，来看<code>#1 = Methodref      #6.#26    // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</code><br>它是一个方法引用（Methodref），指向了第 6 个和第 26 个常量，以此类推看第六个和第 26 个常量的组成，我们能够拼接出后面&#x2F;&#x2F;注释掉的内容<code>java/lang/Object.&quot;&lt;init&gt;&quot;:()V</code><br>这段其实可以理解为改类的实例构造器说明，由于我们所写的 person 方法没有重写构造方法，所以会调用到父类 Object 的构造方法，该方法的返回值为 V，也就是 void 为空<br>再来第二个常量举例 <code>#2 = Fieldref     #5.#27    // org/example/person.num:I</code><br>表明他是一个属性引用，由#5 和#27 常量组成，还是类推过去，我们可以得到后续注释一模一样的内容<code>org/example/person.num:I</code>这就是表明该常量#2 代表<code>org/example/</code>包下 person 类的属性 num，并且类型是 Int<br>第三个稍微记录一下<code>org/example/person.add:(II)I</code> 表明该方法引用代表<code>org/example</code>包下的 person 类的 add 方法，该方法由两个参数，并且返回值为 Int<br>这些都是与我们所写的 java 代码中能对应上的，只不过好像初始值没给出，还只是对其变量的一个 ref<br>最后类型的定义，稍微记录一下<br><img src=\"https://cdn.nlark.com/yuque/0/2024/png/36078896/1717641740183-b078b901-a308-4936-b42a-58d164cfdf1a.png#averageHue=%23292f38&clientId=u28a3eb00-487e-4&from=paste&height=349&id=u19801e55&originHeight=763&originWidth=758&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=68613&status=done&style=none&taskId=u4e31d6e3-631c-4aef-ae10-1de0b5b6092&title=&width=346.2666931152344\" referrerpolicy=\"no-referrer\" alt=\"image.png\"><br> 对于数组类型，每一位使用一个前置的[字符来描述，如定义一个<code>java.lang.String[][]</code>类型的维数组，将被记录为<code>[[Ljava/lang/String;</code><br>补充一组访问标识：也就是各块描述中 flag&#x3D;????的内容<br><img src=\"https://cdn.nlark.com/yuque/0/2024/png/36078896/1717642300346-ced108a6-6fcf-4670-9f1d-ce8b46dce909.png#averageHue=%232a3139&clientId=ubb7bd201-4783-4&from=paste&height=342&id=u9b315a15&originHeight=641&originWidth=1276&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=131356&status=done&style=none&taskId=ucee9e891-bfe8-4ae7-9ce1-67aca9db2ad&title=&width=680.5333333333333\" referrerpolicy=\"no-referrer\" alt=\"image.png\"></p>\n<h2 id=\"方法表集合\"><a href=\"#方法表集合\" class=\"headerlink\" title=\"方法表集合\"></a>方法表集合</h2><p> 最开始常量池的定义中我们单单只说它是字面量(Literal),和符号引用(Symbolic References)的资源仓库，并不表示类方法的具体内容，而紧接常量池的内容下面就是方法表集合。在字节码中，方法以表的集合形式表现。由于各种工具编码的问题，其实该处方法表的内容每个工具都有可能产生不同的细节，我们拿当前 javap 生成的字节码来分析类比<br>这里就拿一个构造方法来看</p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #E06C75\">  </span><span style=\"color: #C678DD\">public</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">org</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #E5C07B\">example</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">person</span><span style=\"color: #ABB2BF\">();</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    descriptor</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> ()</span><span style=\"color: #E5C07B\">V</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    flags</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">ACC_PUBLIC</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    Code</span><span style=\"color: #C678DD\">:</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">      stack</span><span style=\"color: #56B6C2\">=</span><span style=\"color: #D19A66\">2</span><span style=\"color: #ABB2BF\">,</span><span style=\"color: #E06C75\"> locals</span><span style=\"color: #56B6C2\">=</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">,</span><span style=\"color: #E06C75\"> args_size</span><span style=\"color: #56B6C2\">=</span><span style=\"color: #D19A66\">1</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">         </span><span style=\"color: #D19A66\">0</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> aload_0</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">         </span><span style=\"color: #D19A66\">1</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> invokespecial #</span><span style=\"color: #D19A66\">1</span><span style=\"color: #E06C75\">                  </span><span style=\"color: #7F848E; font-style: italic\">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">         </span><span style=\"color: #D19A66\">4</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> aload_0</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">         </span><span style=\"color: #D19A66\">5</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> iconst_1</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">         </span><span style=\"color: #D19A66\">6</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> putfield      #</span><span style=\"color: #D19A66\">2</span><span style=\"color: #E06C75\">                  </span><span style=\"color: #7F848E; font-style: italic\">// Field num:I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">         </span><span style=\"color: #D19A66\">9</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">return</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">      LineNumberTable</span><span style=\"color: #C678DD\">:</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">        line </span><span style=\"color: #D19A66\">3</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> </span><span style=\"color: #D19A66\">0</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">        line </span><span style=\"color: #D19A66\">4</span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> </span><span style=\"color: #D19A66\">4</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">      LocalVariableTable</span><span style=\"color: #C678DD\">:</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">        </span><span style=\"color: #E5C07B\">Start</span><span style=\"color: #E06C75\">  </span><span style=\"color: #E5C07B\">Length</span><span style=\"color: #E06C75\">  </span><span style=\"color: #E5C07B\">Slot</span><span style=\"color: #E06C75\">  </span><span style=\"color: #E5C07B\">Name</span><span style=\"color: #E06C75\">   </span><span style=\"color: #E5C07B\">Signature</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">            </span><span style=\"color: #D19A66\">0</span><span style=\"color: #E06C75\">      </span><span style=\"color: #D19A66\">10</span><span style=\"color: #E06C75\">     </span><span style=\"color: #D19A66\">0</span><span style=\"color: #E06C75\">  </span><span style=\"color: #E5C07B\">this</span><span style=\"color: #E06C75\">   Lorg</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E06C75\">example</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E06C75\">person</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">//上面是javap的内容，下面是idea的内容</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">public</span><span style=\"color: #E06C75\"> </span><span style=\"color: #56B6C2\">&lt;</span><span style=\"color: #E06C75\">init</span><span style=\"color: #56B6C2\">&gt;</span><span style=\"color: #E06C75\">()</span><span style=\"color: #E5C07B\">V</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   </span><span style=\"color: #E5C07B\">L0</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    LINENUMBER </span><span style=\"color: #D19A66\">3</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">L0</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    ALOAD </span><span style=\"color: #D19A66\">0</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #E5C07B\">INVOKESPECIAL</span><span style=\"color: #E06C75\"> java</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E06C75\">lang</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E06C75\">Object</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #56B6C2\">&lt;</span><span style=\"color: #E06C75\">init</span><span style=\"color: #56B6C2\">&gt;</span><span style=\"color: #E06C75\"> ()</span><span style=\"color: #E5C07B\">V</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   </span><span style=\"color: #E5C07B\">L1</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    LINENUMBER </span><span style=\"color: #D19A66\">4</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">L1</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    ALOAD </span><span style=\"color: #D19A66\">0</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #E5C07B\">ICONST_1</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #E5C07B\">PUTFIELD</span><span style=\"color: #E06C75\"> org</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E06C75\">example</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E5C07B\">person</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #E5C07B\">num</span><span style=\"color: #E06C75\"> </span><span style=\"color: #C678DD\">:</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">I</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #E5C07B\">RETURN</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">   </span><span style=\"color: #E5C07B\">L2</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    </span><span style=\"color: #E5C07B\">LOCALVARIABLE</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">this</span><span style=\"color: #E06C75\"> Lorg</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E06C75\">example</span><span style=\"color: #56B6C2\">/</span><span style=\"color: #E06C75\">person</span><span style=\"color: #ABB2BF\">;</span><span style=\"color: #E06C75\"> </span><span style=\"color: #E5C07B\">L0</span><span style=\"color: #E06C75\"> L2 </span><span style=\"color: #D19A66\">0</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    MAXSTACK </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> </span><span style=\"color: #D19A66\">2</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">    MAXLOCALS </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #E06C75\"> </span><span style=\"color: #D19A66\">1</span></span></code></pre></div><p>具体分析：</p>\n<ul>\n<li><code>descriptor: ()V</code>descriptor 主要是对该方法返回值的一个描述</li>\n<li><code>flags: ACC_PUBLIC</code>表示该方法是公共的，具体还有一些 flag 标识参考上方访问标识。</li>\n</ul>\n<p>code 块具体解析：</p>\n<ul>\n<li><code>stack=2</code>最大操作数栈，JVM 运行时会根据该值来分配栈帧中的操作栈深度，此处为 1（懵，学少了）</li>\n<li><code>locals</code>局部变量所需的存储空间，单位为 slot，slot 是虚拟机为局部变量分配内存时所使用的最小单位，为 4 个字节大小。其中，方法参数（实例方法中会固定隐藏一个 this），显示异常处理器参数（trycatch 块中 catch 所定义的异常），方法体中定义的局部变量，都需要使用局部变量表来存放。 locals的大小并不一定等于所有局部变量所占的Slot之和，因为局部变量中的Slot是可以重用的 。（…懵）</li>\n<li><code>args_size</code>方法参数的个数，这里实例化方法为什么会有 1 个参数呢？每个实例方法都会隐藏一个 this 参数</li>\n<li><code>attribute_info</code>这一块呢就是左边是 数字: 操作栈帧的所有内容了，叫做<strong>方法体内容。</strong>具体分析这些操作指令</li>\n</ul>\n<p><code>aload_0</code>：如果是aload_x，则表示从局部变量表中相应位置 x 装载一个对象引用到操作数栈的栈顶。如果是 aload_0,则表示把第零个引用类型本地变量（this 指针）推送到操作数栈顶。<br><code>invokespecial #1</code>：弹栈，并执行 #1 方法。这里我们首先是进行了一波aload_0，也就是把 this 变量压入了栈，然后 invoke 弹栈，将 this 弹出，并作为参数调用进了<init>初始化方法。<br><code>iconst_1</code>：将 int 型常量 1 推送至栈顶（留个伏笔，我们 person 不是有两个定义的属性吗）<br><code>putfield</code>：其实按英文翻译都能猜出来是在干嘛，其实就是为属性赋值。接受一个操作数，这个操作数引用的是运行时常量池的一个字段，比如我们这里#2，那么对应常量池就是<code> #2 = Fieldref  #5.#27  // org/example/person.num:I</code>，为 person 类的 num 属性值。putfield 会弹出两个栈顶两个值，我们刚才栈顶的值为 this 传入了构造 init 方法，所以 putfield 操作之后执行的就是 this.num&#x3D;1<br>最后一个操作码<code>return</code>，也就是返回空内容，方法执行结束。<br>还有一些 invoke 操作栈帧没有提及：</init></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #E06C75\">invokestatic：调用静态方法</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">invokespecial：调用实例构造方法 调用私有方法 调用父类方法</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">invokeinterface：调用接口方法</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">invokevirtual：调用虚方法（除上面三种情况之外的方法，如调用对象方法）</span></span>\n<span class=\"line\"><span style=\"color: #E06C75\">invokedynamic：Lambda的原理</span><span style=\"color: #ABB2BF\">,</span><span style=\"color: #E06C75\">即动态调用</span></span></code></pre></div><p>当然还有很多指令栈帧没有提及，我们之后分析的时候遇到了再记录。</p>\n","feature":true,"text":"背景引入我们平常所写的 Java 是不能被 JVM 识别所运行的，必须将其编译成 class 文件，JVM 才能够识别代码，进行对应的程序操作。Java 有着”...","permalink":"/post/Java字节码初步学习","photos":[],"count_time":{"symbolsCount":"10k","symbolsTime":"9 mins."},"categories":[{"name":"锻刀的理论学习-java字节码","slug":"锻刀的理论学习-java字节码","count":1,"path":"api/categories/锻刀的理论学习-java字节码.json"}],"tags":[{"name":"锻刀","slug":"锻刀","count":13,"path":"api/tags/锻刀.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF%E5%BC%95%E5%85%A5\"><span class=\"toc-text\">背景引入</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Java-%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">Java 字节码文件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E9%87%8F%E6%B1%A0%EF%BC%88Constant-pool%EF%BC%89\"><span class=\"toc-text\">常量池（Constant pool）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%B9%E6%B3%95%E8%A1%A8%E9%9B%86%E5%90%88\"><span class=\"toc-text\">方法表集合</span></a></li></ol></li></ol>","author":{"name":"stoocea","slug":"blog-author","avatar":"https://bu.dusays.com/2024/07/06/6688f66750892.png","link":"/","description":"time thick away","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Ysoserial-JRMPListener/JRMPClient学习","uid":"bca2d9535e8d62874b69184ae85883c1","slug":"JRMPListener Client学习","date":"2024-07-06T07:41:00.000Z","updated":"2024-07-06T07:47:13.274Z","comments":true,"path":"api/articles/JRMPListener Client学习.json","keywords":null,"cover":"https://bu.dusays.com/2024/07/06/6688f66750892.png","text":"RMI 过程回顾回顾一下 RMI 的流程，算是复习。我们就拿一段示例代码来举例子 javaimport java.rmi.Naming; import java...","permalink":"/post/JRMPListener Client学习","photos":[],"count_time":{"symbolsCount":"7.9k","symbolsTime":"7 mins."},"categories":[{"name":"锻刀理论包括一点挥刀练习java-JRMPListener/Client","slug":"锻刀理论包括一点挥刀练习java-JRMPListener-Client","count":1,"path":"api/categories/锻刀理论包括一点挥刀练习java-JRMPListener-Client.json"}],"tags":[{"name":"锻刀","slug":"锻刀","count":13,"path":"api/tags/锻刀.json"}],"author":{"name":"stoocea","slug":"blog-author","avatar":"https://bu.dusays.com/2024/07/06/6688f66750892.png","link":"/","description":"time thick away","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"Java二次反序列化学习","uid":"9eef0bafd340d6fd0d85cf5145bacfba","slug":"Java二次反序列化","date":"2024-06-04T06:00:00.000Z","updated":"2024-06-28T15:09:08.329Z","comments":true,"path":"api/articles/Java二次反序列化.json","keywords":null,"cover":"https://bu.dusays.com/2024/06/28/667ecfe7b6094.webp","text":"前言二次反序列化大多数时候是用来绕过黑名单或者解决不出网的问题，不会作为一条单独且完整的利用链存在，而是作为一个中间节点，用来绕过。二次反序列化一般来说有如下几...","permalink":"/post/Java二次反序列化","photos":[],"count_time":{"symbolsCount":"20k","symbolsTime":"18 mins."},"categories":[{"name":"锻刀的理论学习-java二次反序列化","slug":"锻刀的理论学习-java二次反序列化","count":1,"path":"api/categories/锻刀的理论学习-java二次反序列化.json"}],"tags":[{"name":"锻刀","slug":"锻刀","count":13,"path":"api/tags/锻刀.json"}],"author":{"name":"stoocea","slug":"blog-author","avatar":"https://bu.dusays.com/2024/07/06/6688f66750892.png","link":"/","description":"time thick away","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}