<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Java字节码初步学习 | stoocea's blog</title><link rel="icon" type="image/x-icon" href="https://bu.dusays.com/2024/06/25/667ac0f8ca940.png"><link rel="preload" as="font" crossorigin="anonymous" href="/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/BenderLight.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy"}}</script><link type="text/css" rel="stylesheet" href="/lib/encrypt/hbe.style.css"><script src="//unpkg.com/mermaid@10.5.0/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
 --light-background: url('/img/bk.jpg');
 --theme-encrypt-confirm: 'confirm'
}</style><script defer src="/js/arknights.js"></script><script defer src="/js/search.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@10.5.0/dist/mermaid.esm.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/lib/encrypt/hbe.js"></script><script async src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.busuanzi'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>Java字节码初步学习</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2024-06-10T05:00:00.000Z" id="date"> 2024-06-10</time></div></span><br><span>Last Update: <div class="control"><time datetime="2024-06-10T05:56:29.048Z" id="updated"> 2024-06-10</time></div></span></div></div><hr><div id="post-content"><h1 id="背景引入"><a href="#背景引入" class="headerlink" title="背景引入"></a>背景引入</h1><p>我们平常所写的 Java 是不能被 JVM 识别所运行的，必须将其编译成 class 文件，JVM 才能够识别代码，进行对应的程序操作。<br>Java 有着”一次编译，到处运行”的特点，也就是说当我们对一份 java 代码进行编译之后，得到的 class 文件能够放在任意机器或者任意 OS 系统中的 JVM 中识别并运行。当然 JVM 并不止单单支持 Java。</p>
<h1 id="Java-字节码文件"><a href="#Java-字节码文件" class="headerlink" title="Java 字节码文件"></a>Java 字节码文件</h1><p>class 文件本质是一个以 8 位字节为基础的二进制流。所有的 class 文件开头的前四个字节都是固定的魔数– 0xCAFEBABE  （咖啡宝贝）。当然这个主要是用来让 JVM 识别该文件是否为 class 文件<br>该 class 文件编译之前采用的 Java 版本在魔数之后的 4 个字节给出，前两个字节表示次版本号，后两个字节表示主版本号。class 文件的 10 进制形式能够在 oracle 官网进行版本查询，得知更加具体的版本号<br>比如我此时编译一份 java 文件</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> person <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token constant">NUM</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> num<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a <span class="token operator">-</span> b <span class="token operator">-</span> <span class="token constant">NUM</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p class='item-img' data-src='https://cdn.nlark.com/yuque/0/2024/png/36078896/1717636679191-592e658b-375d-44f1-b31c-c6e262a8d8e5.png#averageHue=%2339352f&clientId=u2db5ed67-1d88-4&from=paste&height=412&id=u16fc67c3&originHeight=772&originWidth=891&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=103764&status=done&style=none&taskId=ue9b5197e-87d1-44da-9d2b-7a32012e4f1&title=&width=475.2'><img src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1717636679191-592e658b-375d-44f1-b31c-c6e262a8d8e5.png#averageHue=%2339352f&clientId=u2db5ed67-1d88-4&from=paste&height=412&id=u16fc67c3&originHeight=772&originWidth=891&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=103764&status=done&style=none&taskId=ue9b5197e-87d1-44da-9d2b-7a32012e4f1&title=&width=475.2" referrerpolicy="no-referrer" alt="image.png"><br>这还只是 class 文件的二进制形式，我们能够通过其他工具查看到更加具体的 class 字节码内容。<br>比如 idea 的自带的 view 功能。这里我们依然选择 person 类编译之后的 class 文件进行查看<br>选定 person.class 文件之后点击上方的 view，然后选择 Show ByteCode<br class='item-img' data-src='https://cdn.nlark.com/yuque/0/2024/png/36078896/1717637395234-7db3aa5f-6732-4237-b928-bb284ea54bbf.png#averageHue=%232b2d31&clientId=u2db5ed67-1d88-4&from=paste&height=725&id=ue126df8f&originHeight=1360&originWidth=2560&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=500817&status=done&style=none&taskId=ua6b81c73-8d1e-4bf8-92b9-3633c426f7d&title=&width=1365.3333333333333'><img src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1717637395234-7db3aa5f-6732-4237-b928-bb284ea54bbf.png#averageHue=%232b2d31&clientId=u2db5ed67-1d88-4&from=paste&height=725&id=ue126df8f&originHeight=1360&originWidth=2560&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=500817&status=done&style=none&taskId=ua6b81c73-8d1e-4bf8-92b9-3633c426f7d&title=&width=1365.3333333333333" referrerpolicy="no-referrer" alt="image.png"><br>就可以得到这么一份还算比较好看的 Bytecode<br class='item-img' data-src='https://cdn.nlark.com/yuque/0/2024/png/36078896/1717637421316-50c01060-83ac-484b-beb3-5bcd227dc70f.png#averageHue=%23262829&clientId=u2db5ed67-1d88-4&from=paste&height=730&id=u9197cf49&originHeight=1368&originWidth=1417&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=85328&status=done&style=none&taskId=ufe4b5178-5ce0-4385-94d7-88ac8dd09a4&title=&width=755.7333333333333'><img src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1717637421316-50c01060-83ac-484b-beb3-5bcd227dc70f.png#averageHue=%23262829&clientId=u2db5ed67-1d88-4&from=paste&height=730&id=u9197cf49&originHeight=1368&originWidth=1417&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=85328&status=done&style=none&taskId=ufe4b5178-5ce0-4385-94d7-88ac8dd09a4&title=&width=755.7333333333333" referrerpolicy="no-referrer" alt="image.png"><br>或者我们采用<code>javap</code>java 原生的字节码工具也能够查看。<br>来一份 javap 的参数表</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">-</span>help  <span class="token operator">--</span>help  <span class="token operator">-</span><span class="token operator">?</span>        输出此用法消息
 <span class="token operator">-</span>version                 版本信息
 <span class="token operator">-</span>v  <span class="token operator">-</span>verbose             输出附加信息
 <span class="token operator">-</span>l                       输出行号和本地变量表
 <span class="token operator">-</span><span class="token keyword">public</span>                  仅显示公共类和成员
 <span class="token operator">-</span><span class="token keyword">protected</span>               显示受保护的<span class="token operator">/</span>公共类和成员
 <span class="token operator">-</span><span class="token keyword">package</span>                 显示程序包<span class="token operator">/</span>受保护的<span class="token operator">/</span>公共类
                          和成员 <span class="token punctuation">(</span>默认<span class="token punctuation">)</span>
 <span class="token operator">-</span>p  <span class="token operator">-</span><span class="token keyword">private</span>             显示所有类和成员
 <span class="token operator">-</span>c                       对代码进行反汇编
 <span class="token operator">-</span>s                       输出内部类型签名
 <span class="token operator">-</span>sysinfo                 显示正在处理的类的
                          系统信息 <span class="token punctuation">(</span>路径<span class="token punctuation">,</span> 大小<span class="token punctuation">,</span> 日期<span class="token punctuation">,</span> <span class="token constant">MD5</span> 散列<span class="token punctuation">)</span>
 <span class="token operator">-</span>constants               显示最终常量
 <span class="token operator">-</span>classpath <span class="token generics"><span class="token punctuation">&lt;</span>path<span class="token punctuation">></span></span>        指定查找用户类文件的位置
 <span class="token operator">-</span>cp <span class="token generics"><span class="token punctuation">&lt;</span>path<span class="token punctuation">></span></span>               指定查找用户类文件的位置
 <span class="token operator">-</span>bootclasspath <span class="token generics"><span class="token punctuation">&lt;</span>path<span class="token punctuation">></span></span>    覆盖引导类文件的位置<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里用 <code>javap -verbose -p person.class</code> 生成的字节码查看如下</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>person
  minor version<span class="token operator">:</span> <span class="token number">0</span>
  major version<span class="token operator">:</span> <span class="token number">52</span>
  flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_SUPER</span>
<span class="token class-name">Constant</span> pool<span class="token operator">:</span>
   #<span class="token number">1</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">6.</span>#<span class="token number">26</span>         <span class="token comment">// java/lang/Object."&lt;init>":()V</span>
   #<span class="token number">2</span> <span class="token operator">=</span> <span class="token class-name">Fieldref</span>           #<span class="token number">5.</span>#<span class="token number">27</span>         <span class="token comment">// org/example/person.num:I</span>
   #<span class="token number">3</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">5.</span>#<span class="token number">28</span>         <span class="token comment">// org/example/person.add:(II)I</span>
   #<span class="token number">4</span> <span class="token operator">=</span> <span class="token class-name">Fieldref</span>           #<span class="token number">5.</span>#<span class="token number">29</span>         <span class="token comment">// org/example/person.NUM:I</span>
   #<span class="token number">5</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">30</span>            <span class="token comment">// org/example/person</span>
   #<span class="token number">6</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">31</span>            <span class="token comment">// java/lang/Object</span>
   #<span class="token number">7</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               num
   #<span class="token number">8</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">I</span>
   #<span class="token number">9</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token constant">NUM</span>
  #<span class="token number">10</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span>
  #<span class="token number">11</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
  #<span class="token number">12</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Code</span>
  #<span class="token number">13</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">LineNumberTable</span>
  #<span class="token number">14</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">LocalVariableTable</span>
  #<span class="token number">15</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token keyword">this</span>
  #<span class="token number">16</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Lorg</span><span class="token operator">/</span>example<span class="token operator">/</span>person<span class="token punctuation">;</span>
  #<span class="token number">17</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               func
  #<span class="token number">18</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token constant">II</span><span class="token punctuation">)</span><span class="token class-name">I</span>
  #<span class="token number">19</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               a
  #<span class="token number">20</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               b
  #<span class="token number">21</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               add
  #<span class="token number">22</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               sub
  #<span class="token number">23</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token generics"><span class="token punctuation">&lt;</span>clinit<span class="token punctuation">></span></span>
  #<span class="token number">24</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">SourceFile</span>
  #<span class="token number">25</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               person<span class="token punctuation">.</span>java
  #<span class="token number">26</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">10</span><span class="token operator">:</span>#<span class="token number">11</span>        <span class="token comment">// "&lt;init>":()V</span>
  #<span class="token number">27</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">7</span><span class="token operator">:</span>#<span class="token number">8</span>          <span class="token comment">// num:I</span>
  #<span class="token number">28</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">21</span><span class="token operator">:</span>#<span class="token number">18</span>        <span class="token comment">// add:(II)I</span>
  #<span class="token number">29</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">9</span><span class="token operator">:</span>#<span class="token number">8</span>          <span class="token comment">// NUM:I</span>
  #<span class="token number">30</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               org<span class="token operator">/</span>example<span class="token operator">/</span>person
  #<span class="token number">31</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> num<span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token class-name">I</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PRIVATE</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token constant">NUM</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token class-name">I</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_STATIC</span>

  <span class="token keyword">public</span> org<span class="token punctuation">.</span>example<span class="token punctuation">.</span><span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span><span class="token operator">:</span> aload_0
         <span class="token number">1</span><span class="token operator">:</span> invokespecial #<span class="token number">1</span>                  <span class="token comment">// Method java/lang/Object."&lt;init>":()V</span>
         <span class="token number">4</span><span class="token operator">:</span> aload_0
         <span class="token number">5</span><span class="token operator">:</span> iconst_1
         <span class="token number">6</span><span class="token operator">:</span> putfield      #<span class="token number">2</span>                  <span class="token comment">// Field num:I</span>
         <span class="token number">9</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">3</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">4</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">0</span>      <span class="token number">10</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lorg</span><span class="token operator">/</span>example<span class="token operator">/</span>person<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token constant">II</span><span class="token punctuation">)</span><span class="token class-name">I</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">3</span>
         <span class="token number">0</span><span class="token operator">:</span> aload_0
         <span class="token number">1</span><span class="token operator">:</span> iload_1
         <span class="token number">2</span><span class="token operator">:</span> iload_2
         <span class="token number">3</span><span class="token operator">:</span> invokevirtual #<span class="token number">3</span>                  <span class="token comment">// Method add:(II)I</span>
         <span class="token number">6</span><span class="token operator">:</span> ireturn
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">8</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">0</span>       <span class="token number">7</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lorg</span><span class="token operator">/</span>example<span class="token operator">/</span>person<span class="token punctuation">;</span>
            <span class="token number">0</span>       <span class="token number">7</span>     <span class="token number">1</span>     a   <span class="token class-name">I</span>
            <span class="token number">0</span>       <span class="token number">7</span>     <span class="token number">2</span>     b   <span class="token class-name">I</span>

  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token constant">II</span><span class="token punctuation">)</span><span class="token class-name">I</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">3</span>
         <span class="token number">0</span><span class="token operator">:</span> iload_1
         <span class="token number">1</span><span class="token operator">:</span> iload_2
         <span class="token number">2</span><span class="token operator">:</span> iadd
         <span class="token number">3</span><span class="token operator">:</span> aload_0
         <span class="token number">4</span><span class="token operator">:</span> getfield      #<span class="token number">2</span>                  <span class="token comment">// Field num:I</span>
         <span class="token number">7</span><span class="token operator">:</span> iadd
         <span class="token number">8</span><span class="token operator">:</span> ireturn
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">12</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">0</span>       <span class="token number">9</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lorg</span><span class="token operator">/</span>example<span class="token operator">/</span>person<span class="token punctuation">;</span>
            <span class="token number">0</span>       <span class="token number">9</span>     <span class="token number">1</span>     a   <span class="token class-name">I</span>
            <span class="token number">0</span>       <span class="token number">9</span>     <span class="token number">2</span>     b   <span class="token class-name">I</span>

  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token constant">II</span><span class="token punctuation">)</span><span class="token class-name">I</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">3</span>
         <span class="token number">0</span><span class="token operator">:</span> iload_1
         <span class="token number">1</span><span class="token operator">:</span> iload_2
         <span class="token number">2</span><span class="token operator">:</span> isub
         <span class="token number">3</span><span class="token operator">:</span> getstatic     #<span class="token number">4</span>                  <span class="token comment">// Field NUM:I</span>
         <span class="token number">6</span><span class="token operator">:</span> isub
         <span class="token number">7</span><span class="token operator">:</span> ireturn
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">16</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">0</span>       <span class="token number">8</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lorg</span><span class="token operator">/</span>example<span class="token operator">/</span>person<span class="token punctuation">;</span>
            <span class="token number">0</span>       <span class="token number">8</span>     <span class="token number">1</span>     a   <span class="token class-name">I</span>
            <span class="token number">0</span>       <span class="token number">8</span>     <span class="token number">2</span>     b   <span class="token class-name">I</span>

  <span class="token keyword">static</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_STATIC</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">0</span>
         <span class="token number">0</span><span class="token operator">:</span> bipush        <span class="token number">100</span>
         <span class="token number">2</span><span class="token operator">:</span> putstatic     #<span class="token number">4</span>                  <span class="token comment">// Field NUM:I</span>
         <span class="token number">5</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">5</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>发现结果还是不同的，javap 的生成感觉可读性更高。两者内容比较是没有问题的。<code>javap -verbose -p person.class</code>的内容直接把常量池中的所有信息都打印出来，我们也能够更好的查找。</p>
<h2 id="常量池（Constant-pool）"><a href="#常量池（Constant-pool）" class="headerlink" title="常量池（Constant pool）"></a>常量池（Constant pool）</h2><p>最显著的就是我们最开始用<code>javap -verbose -p person.class</code>产生的结果中那一堆用#表示的信息。<br>常量池可以理解为 class 文件中的资源仓库，主要存放两大类常量：字面量(Literal),和符号引用(Symbolic References) 。字面量就类似于 java 中的常量概念，如文本字符串，final 常量等。而符号引用则属于编译原理方面的概念，包含以下三种：</p>
<ul>
<li>类接口的全限定名</li>
<li>字段的名称和描述符号</li>
<li>方法的名称和描述</li>
</ul>
<p>我们截取生成字节码中常量池的部分内容</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Constant</span> pool<span class="token operator">:</span>
   #<span class="token number">1</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">6.</span>#<span class="token number">26</span>         <span class="token comment">// java/lang/Object."&lt;init>":()V</span>
   #<span class="token number">2</span> <span class="token operator">=</span> <span class="token class-name">Fieldref</span>           #<span class="token number">5.</span>#<span class="token number">27</span>         <span class="token comment">// org/example/person.num:I</span>
   #<span class="token number">3</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">5.</span>#<span class="token number">28</span>         <span class="token comment">// org/example/person.add:(II)I</span>
   #<span class="token number">4</span> <span class="token operator">=</span> <span class="token class-name">Fieldref</span>           #<span class="token number">5.</span>#<span class="token number">29</span>         <span class="token comment">// org/example/person.NUM:I</span>
   #<span class="token number">5</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">30</span>            <span class="token comment">// org/example/person</span>
   #<span class="token number">6</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">31</span>            <span class="token comment">// java/lang/Object</span>
   #<span class="token number">7</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               num
   #<span class="token number">8</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">I</span>
  #<span class="token number">10</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span>
  #<span class="token number">11</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
  #<span class="token number">26</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">10</span><span class="token operator">:</span>#<span class="token number">11</span>        <span class="token comment">// "&lt;init>":()V</span>
  #<span class="token number">27</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">7</span><span class="token operator">:</span>#<span class="token number">8</span>
  #<span class="token number">31</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>举个例子，来看<code>#1 = Methodref      #6.#26    // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</code><br>它是一个方法引用（Methodref），指向了第 6 个和第 26 个常量，以此类推看第六个和第 26 个常量的组成，我们能够拼接出后面&#x2F;&#x2F;注释掉的内容<code>java/lang/Object.&quot;&lt;init&gt;&quot;:()V</code><br>这段其实可以理解为改类的实例构造器说明，由于我们所写的 person 方法没有重写构造方法，所以会调用到父类 Object 的构造方法，该方法的返回值为 V，也就是 void 为空<br>再来第二个常量举例 <code>#2 = Fieldref     #5.#27    // org/example/person.num:I</code><br>表明他是一个属性引用，由#5 和#27 常量组成，还是类推过去，我们可以得到后续注释一模一样的内容<code>org/example/person.num:I</code>这就是表明该常量#2 代表<code>org/example/</code>包下 person 类的属性 num，并且类型是 Int<br>第三个稍微记录一下<code>org/example/person.add:(II)I</code> 表明该方法引用代表<code>org/example</code>包下的 person 类的 add 方法，该方法由两个参数，并且返回值为 Int<br>这些都是与我们所写的 java 代码中能对应上的，只不过好像初始值没给出，还只是对其变量的一个 ref<br>最后类型的定义，稍微记录一下<br class='item-img' data-src='https://cdn.nlark.com/yuque/0/2024/png/36078896/1717641740183-b078b901-a308-4936-b42a-58d164cfdf1a.png#averageHue=%23292f38&clientId=u28a3eb00-487e-4&from=paste&height=349&id=u19801e55&originHeight=763&originWidth=758&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=68613&status=done&style=none&taskId=u4e31d6e3-631c-4aef-ae10-1de0b5b6092&title=&width=346.2666931152344'><img src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1717641740183-b078b901-a308-4936-b42a-58d164cfdf1a.png#averageHue=%23292f38&clientId=u28a3eb00-487e-4&from=paste&height=349&id=u19801e55&originHeight=763&originWidth=758&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=68613&status=done&style=none&taskId=u4e31d6e3-631c-4aef-ae10-1de0b5b6092&title=&width=346.2666931152344" referrerpolicy="no-referrer" alt="image.png"><br> 对于数组类型，每一位使用一个前置的[字符来描述，如定义一个<code>java.lang.String[][]</code>类型的维数组，将被记录为<code>[[Ljava/lang/String;</code><br>补充一组访问标识：也就是各块描述中 flag&#x3D;????的内容<br class='item-img' data-src='https://cdn.nlark.com/yuque/0/2024/png/36078896/1717642300346-ced108a6-6fcf-4670-9f1d-ce8b46dce909.png#averageHue=%232a3139&clientId=ubb7bd201-4783-4&from=paste&height=342&id=u9b315a15&originHeight=641&originWidth=1276&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=131356&status=done&style=none&taskId=ucee9e891-bfe8-4ae7-9ce1-67aca9db2ad&title=&width=680.5333333333333'><img src="https://cdn.nlark.com/yuque/0/2024/png/36078896/1717642300346-ced108a6-6fcf-4670-9f1d-ce8b46dce909.png#averageHue=%232a3139&clientId=ubb7bd201-4783-4&from=paste&height=342&id=u9b315a15&originHeight=641&originWidth=1276&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=131356&status=done&style=none&taskId=ucee9e891-bfe8-4ae7-9ce1-67aca9db2ad&title=&width=680.5333333333333" referrerpolicy="no-referrer" alt="image.png"></p>
<h2 id="方法表集合"><a href="#方法表集合" class="headerlink" title="方法表集合"></a>方法表集合</h2><p> 最开始常量池的定义中我们单单只说它是字面量(Literal),和符号引用(Symbolic References)的资源仓库，并不表示类方法的具体内容，而紧接常量池的内容下面就是方法表集合。在字节码中，方法以表的集合形式表现。由于各种工具编码的问题，其实该处方法表的内容每个工具都有可能产生不同的细节，我们拿当前 javap 生成的字节码来分析类比<br>这里就拿一个构造方法来看</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">  <span class="token keyword">public</span> org<span class="token punctuation">.</span>example<span class="token punctuation">.</span><span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span><span class="token operator">:</span> aload_0
         <span class="token number">1</span><span class="token operator">:</span> invokespecial #<span class="token number">1</span>                  <span class="token comment">// Method java/lang/Object."&lt;init>":()V</span>
         <span class="token number">4</span><span class="token operator">:</span> aload_0
         <span class="token number">5</span><span class="token operator">:</span> iconst_1
         <span class="token number">6</span><span class="token operator">:</span> putfield      #<span class="token number">2</span>                  <span class="token comment">// Field num:I</span>
         <span class="token number">9</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">3</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">4</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">0</span>      <span class="token number">10</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lorg</span><span class="token operator">/</span>example<span class="token operator">/</span>person<span class="token punctuation">;</span>

<span class="token comment">//上面是javap的内容，下面是idea的内容</span>

 <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
   <span class="token constant">L0</span>
    <span class="token constant">LINENUMBER</span> <span class="token number">3</span> <span class="token constant">L0</span>
    <span class="token constant">ALOAD</span> <span class="token number">0</span>
    <span class="token constant">INVOKESPECIAL</span> java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
   <span class="token constant">L1</span>
    <span class="token constant">LINENUMBER</span> <span class="token number">4</span> <span class="token constant">L1</span>
    <span class="token constant">ALOAD</span> <span class="token number">0</span>
    <span class="token constant">ICONST_1</span>
    <span class="token constant">PUTFIELD</span> org<span class="token operator">/</span>example<span class="token operator">/</span>person<span class="token punctuation">.</span>num <span class="token operator">:</span> <span class="token class-name">I</span>
    <span class="token constant">RETURN</span>
   <span class="token constant">L2</span>
    <span class="token constant">LOCALVARIABLE</span> <span class="token keyword">this</span> <span class="token class-name">Lorg</span><span class="token operator">/</span>example<span class="token operator">/</span>person<span class="token punctuation">;</span> <span class="token constant">L0</span> <span class="token constant">L2</span> <span class="token number">0</span>
    <span class="token constant">MAXSTACK</span> <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token constant">MAXLOCALS</span> <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>具体分析：</p>
<ul>
<li><code>descriptor: ()V</code>descriptor 主要是对该方法返回值的一个描述</li>
<li><code>flags: ACC_PUBLIC</code>表示该方法是公共的，具体还有一些 flag 标识参考上方访问标识。</li>
</ul>
<p>code 块具体解析：</p>
<ul>
<li><code>stack=2</code>最大操作数栈，JVM 运行时会根据该值来分配栈帧中的操作栈深度，此处为 1（懵，学少了）</li>
<li><code>locals</code>局部变量所需的存储空间，单位为 slot，slot 是虚拟机为局部变量分配内存时所使用的最小单位，为 4 个字节大小。其中，方法参数（实例方法中会固定隐藏一个 this），显示异常处理器参数（trycatch 块中 catch 所定义的异常），方法体中定义的局部变量，都需要使用局部变量表来存放。 locals的大小并不一定等于所有局部变量所占的Slot之和，因为局部变量中的Slot是可以重用的 。（…懵）</li>
<li><code>args_size</code>方法参数的个数，这里实例化方法为什么会有 1 个参数呢？每个实例方法都会隐藏一个 this 参数</li>
<li><code>attribute_info</code>这一块呢就是左边是 数字: 操作栈帧的所有内容了，叫做<strong>方法体内容。</strong>具体分析这些操作指令</li>
</ul>
<p><code>aload_0</code>：如果是aload_x，则表示从局部变量表中相应位置 x 装载一个对象引用到操作数栈的栈顶。如果是 aload_0,则表示把第零个引用类型本地变量（this 指针）推送到操作数栈顶。<br><code>invokespecial #1</code>：弹栈，并执行 #1 方法。这里我们首先是进行了一波aload_0，也就是把 this 变量压入了栈，然后 invoke 弹栈，将 this 弹出，并作为参数调用进了<init>初始化方法。<br><code>iconst_1</code>：将 int 型常量 1 推送至栈顶（留个伏笔，我们 person 不是有两个定义的属性吗）<br><code>putfield</code>：其实按英文翻译都能猜出来是在干嘛，其实就是为属性赋值。接受一个操作数，这个操作数引用的是运行时常量池的一个字段，比如我们这里#2，那么对应常量池就是<code> #2 = Fieldref  #5.#27  // org/example/person.num:I</code>，为 person 类的 num 属性值。putfield 会弹出两个栈顶两个值，我们刚才栈顶的值为 this 传入了构造 init 方法，所以 putfield 操作之后执行的就是 this.num&#x3D;1<br>最后一个操作码<code>return</code>，也就是返回空内容，方法执行结束。<br>还有一些 invoke 操作栈帧没有提及：</init></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">invokestatic：调用静态方法
invokespecial：调用实例构造方法 调用私有方法 调用父类方法
invokeinterface：调用接口方法
invokevirtual：调用虚方法（除上面三种情况之外的方法，如调用对象方法）
invokedynamic：<span class="token class-name">Lambda</span>的原理<span class="token punctuation">,</span>即动态调用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当然还有很多指令栈帧没有提及，我们之后分析的时候遇到了再记录。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/post/Java%E4%BA%8C%E6%AC%A1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.html">Java二次反序列化学习 Prev →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://bu.dusays.com/2024/06/25/667ac0f8ca940.png" alt="Logo"></a><h1 id="Dr"><a href="/">stoocea</a></h1><div id="description"><p>time thicking away</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E5%BC%95%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">背景引入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">Java 字节码文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0%EF%BC%88Constant-pool%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">常量池（Constant pool）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%A1%A8%E9%9B%86%E5%90%88"><span class="toc-number">2.2.</span> <span class="toc-text">方法表集合</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>